{
  "id": "pinia",
  "name": "Pinia 备忘清单",
  "title": "这是一份 [`Pinia`](https://pinia.vuejs.org/) 状态管理库的备忘单，列出了 Pinia 的常用命令和操作。",
  "icon": "https://raw.githubusercontent.com/jaywcjlove/reference/main/assets/pinia.svg",
  "sections": [
    {
      "id": "intro",
      "title": "简介",
      "startIndex": 0
    },
    {
      "id": "s1",
      "title": "入门",
      "startIndex": 1
    },
    {
      "id": "s2",
      "title": "高级用法",
      "startIndex": 14
    },
    {
      "id": "s3",
      "title": "另见",
      "startIndex": 40
    }
  ],
  "cards": [
    {
      "id": "intro-0",
      "sectionId": "intro",
      "title": "简介",
      "kind": "text",
      "body": "这是一份 [`Pinia`](https://pinia.vuejs.org/) 状态管理库的备忘单，列出了 Pinia 的常用命令和操作。"
    },
    {
      "id": "s1-1",
      "sectionId": "s1",
      "title": "安装 Pinia",
      "kind": "code",
      "lang": "bash",
      "code": "npm install pinia\n# or\nyarn add pinia\n# or\npnpm add pinia"
    },
    {
      "id": "s1-2",
      "sectionId": "s1",
      "title": "定义 Store",
      "kind": "text",
      "body": "创建一个 store 文件（例如 `src/stores/counter.js`），并定义 `store`"
    },
    {
      "id": "s1-3",
      "sectionId": "s1",
      "title": "定义 Store",
      "kind": "code",
      "lang": "javascript",
      "code": "import { defineStore } from 'pinia'\n\nexport const useCounterStore = defineStore('counter', {\n  state: () => ({\n    count: 0\n  }),\n  actions: {\n    increment() {\n      this.count++\n    }\n  },\n  getters: {\n    doubleCount: (state) => state.count * 2\n  }\n})"
    },
    {
      "id": "s1-4",
      "sectionId": "s1",
      "title": "创建 Pinia 实例",
      "kind": "code",
      "lang": "javascript",
      "code": "import { createApp } from 'vue'\nimport { createPinia } from 'pinia'\nimport App from './App.vue'\n\nconst app = createApp(App)\nconst pinia = createPinia()\n\napp.use(pinia)\napp.mount('#app')"
    },
    {
      "id": "s1-5",
      "sectionId": "s1",
      "title": "创建 Pinia 实例",
      "kind": "text",
      "body": "在你的 [Vue](./vue.md) 应用中创建一个 Pinia 实例并将其传递给 [Vue](./vue.md)"
    },
    {
      "id": "s1-6",
      "sectionId": "s1",
      "title": "热重载 Store",
      "kind": "text",
      "body": "使用 Vite 时，你可以启用热重载功能："
    },
    {
      "id": "s1-7",
      "sectionId": "s1",
      "title": "热重载 Store",
      "kind": "code",
      "lang": "javascript",
      "code": "if (import.meta.hot) {\n  import.meta.hot.accept(acceptHMRUpdate(useCounterStore, import.meta.hot))\n}"
    },
    {
      "id": "s1-8",
      "sectionId": "s1",
      "title": "使用 Store",
      "kind": "text",
      "body": "在组件中使用 `store`"
    },
    {
      "id": "s1-9",
      "sectionId": "s1",
      "title": "使用 Store",
      "kind": "code",
      "lang": "javascript",
      "code": "<template>\n  <div>\n    <p>Count: {{ counterStore.count }}</p>\n    <p>Double Count: {{ counterStore.doubleCount }}</p>\n    <button @click=\"counterStore.increment\">Increment</button>\n  </div>\n</template>\n\n<script>\nimport { useCounterStore } from '@/stores/counter'\n\nexport default {\n  setup() {\n    const counterStore = useCounterStore()\n\n    return {\n      counterStore\n    }\n  }\n}\n</script>"
    },
    {
      "id": "s1-10",
      "sectionId": "s1",
      "title": "Modules 模式",
      "kind": "text",
      "body": "Pinia 不使用传统的 Vuex 模块模式。相反，推荐使用独立的 store 文件："
    },
    {
      "id": "s1-11",
      "sectionId": "s1",
      "title": "Modules 模式",
      "kind": "code",
      "lang": "javascript",
      "code": "// src/stores/user.js\nimport { defineStore } from 'pinia'\n\nexport const useUserStore = defineStore('user', {\n  state: () => ({\n    name: 'Alice',\n    age: 25\n  }),\n  actions: {\n    setName(name) {\n      this.name = name\n    }\n  },\n  getters: {\n    isAdult: (state) => state.age >= 18\n  }\n})"
    },
    {
      "id": "s1-12",
      "sectionId": "s1",
      "title": "使用 Options API",
      "kind": "text",
      "body": "如果你更喜欢 Options API，可以这样使用 Pinia："
    },
    {
      "id": "s1-13",
      "sectionId": "s1",
      "title": "使用 Options API",
      "kind": "code",
      "lang": "javascript",
      "code": "<script>\nimport { defineComponent } from 'vue'\nimport { useCounterStore } from '@/stores/counter'\n\nexport default defineComponent({\n  setup() {\n    const counterStore = useCounterStore()\n\n    return {\n      counterStore\n    }\n  }\n})\n</script>"
    },
    {
      "id": "s2-14",
      "sectionId": "s2",
      "title": "使用组合函数",
      "kind": "text",
      "body": "你可以将 store 与组合函数一起使用："
    },
    {
      "id": "s2-15",
      "sectionId": "s2",
      "title": "使用组合函数",
      "kind": "code",
      "lang": "javascript",
      "code": "// src/composables/useCounter.js\nimport { useCounterStore } from '@/stores/counter'\n\nexport function useCounter() {\n  const counterStore = useCounterStore()\n\n  return {\n    count: counterStore.count,\n    doubleCount: counterStore.doubleCount,\n    increment: counterStore.increment\n  }\n}"
    },
    {
      "id": "s2-16",
      "sectionId": "s2",
      "title": "插件",
      "kind": "text",
      "body": "Pinia 支持插件。你可以编写插件来扩展 Pinia 的功能："
    },
    {
      "id": "s2-17",
      "sectionId": "s2",
      "title": "插件",
      "kind": "code",
      "lang": "javascript",
      "code": "// src/plugins/piniaPlugin.js\nexport function piniaPlugin({ store }) {\n  store.$onAction(({ name, store, args, after, onError }) => {\n    console.log(`Action ${name} was called with args:`, args)\n  })\n}\n\n// main.js\nimport { createPinia } from 'pinia'\nimport { piniaPlugin } from './plugins/piniaPlugin'\n\nconst pinia = createPinia()\npinia.use(piniaPlugin)"
    },
    {
      "id": "s2-18",
      "sectionId": "s2",
      "title": "持久化状态",
      "kind": "text",
      "body": "#### 1. 安装  `pinia-plugin-persist`\n<!--rehype:style=color:#228e6c;font-weight: bold;text-align: left;-->"
    },
    {
      "id": "s2-19",
      "sectionId": "s2",
      "title": "持久化状态",
      "kind": "code",
      "lang": "bash",
      "code": "npm  pinia-plugin-persist"
    },
    {
      "id": "s2-20",
      "sectionId": "s2",
      "title": "持久化状态",
      "kind": "text",
      "body": "#### 2. 配置 Pinia 和 `pinia-plugin-persist`\n<!--rehype:style=color:#228e6c;font-weight: bold;text-align: left;-->"
    },
    {
      "id": "s2-21",
      "sectionId": "s2",
      "title": "持久化状态",
      "kind": "text",
      "body": "在你的入口文件中配置 Pinia 和 `pinia-plugin-persist`。"
    },
    {
      "id": "s2-22",
      "sectionId": "s2",
      "title": "持久化状态",
      "kind": "text",
      "body": "**⚠️ Vue 2 项目**"
    },
    {
      "id": "s2-23",
      "sectionId": "s2",
      "title": "持久化状态",
      "kind": "code",
      "lang": "javascript",
      "code": "import Vue from 'vue'\nimport vueCompositionApi from '@vue/composition-api'\nimport { createPinia, PiniaVuePlugin } from 'pinia'\nimport piniaPersist from 'pinia-plugin-persist'\nimport App from './App.vue'\n\nVue.use(vueCompositionApi)\nVue.use(PiniaVuePlugin)\n\nconst pinia = createPinia()\npinia.use(piniaPersist)\n\nnew Vue({\n  pinia,\n  render: h => h(App)\n}).$mount('#app')"
    },
    {
      "id": "s2-24",
      "sectionId": "s2",
      "title": "持久化状态",
      "kind": "text",
      "body": "**Vue 3 项目：**"
    },
    {
      "id": "s2-25",
      "sectionId": "s2",
      "title": "持久化状态",
      "kind": "code",
      "lang": "javascript",
      "code": "import { createApp } from 'vue'\nimport { createPinia } from 'pinia'\nimport piniaPersist from 'pinia-plugin-persist'\nimport App from './App.vue'\n\nconst pinia = createPinia()\npinia.use(piniaPersist)\n\ncreateApp(App)\n  .use(pinia)\n  .mount('#app')"
    },
    {
      "id": "s2-26",
      "sectionId": "s2",
      "title": "持久化状态",
      "kind": "text",
      "body": "#### 3. 创建 Store 并启用持久化\n<!--rehype:style=color:#228e6c;font-weight: bold;text-align: left;-->"
    },
    {
      "id": "s2-27",
      "sectionId": "s2",
      "title": "持久化状态",
      "kind": "text",
      "body": "创建一个 Pinia store，并启用持久化存储。"
    },
    {
      "id": "s2-28",
      "sectionId": "s2",
      "title": "持久化状态",
      "kind": "code",
      "lang": "javascript",
      "code": "// stores/userStore.js\nimport { defineStore } from 'pinia'\n\nexport const useUserStore = defineStore('userStore', {\n  state: () => ({\n    firstName: 'S',\n    lastName: 'L',\n    accessToken: 'xxxxxxxxxxxxx'\n  }),\n  actions: {\n    setToken(value) {\n      this.accessToken = value\n    }\n  },\n  persist: {\n    enabled: true,\n    strategies: [\n      {\n        storage: localStorage,\n        paths: ['accessToken']\n      }\n    ]\n  }\n})"
    },
    {
      "id": "s2-29",
      "sectionId": "s2",
      "title": "持久化状态",
      "kind": "text",
      "body": "#### 4. 使用 Store\n<!--rehype:style=color:#228e6c;font-weight: bold;text-align: left;-->"
    },
    {
      "id": "s2-30",
      "sectionId": "s2",
      "title": "持久化状态",
      "kind": "text",
      "body": "在组件中使用创建好的 store。"
    },
    {
      "id": "s2-31",
      "sectionId": "s2",
      "title": "持久化状态",
      "kind": "code",
      "lang": "javascript",
      "code": "// src/components/SomeComponent.vue\n<template>\n  <div>\n    <p>{{ userStore.firstName }} {{ userStore.lastName }}</p>\n    <p>{{ userStore.accessToken }}</p>\n  </div>\n</template>\n\n<script>\nimport { useUserStore } from '@/stores/userStore'\n\nexport default {\n  setup() {\n    const userStore = useUserStore()\n    \n    return { userStore }\n  }\n}\n</script>"
    },
    {
      "id": "s2-32",
      "sectionId": "s2",
      "title": "SSR 支持",
      "kind": "text",
      "body": "Pinia 支持服务端渲染 (SSR)。在你的 SSR 入口文件中创建 Pinia 实例："
    },
    {
      "id": "s2-33",
      "sectionId": "s2",
      "title": "SSR 支持",
      "kind": "code",
      "lang": "javascript",
      "code": "import { createPinia } from 'pinia'\n\nexport function createApp() {\n  const app = createSSRApp(App)\n  const pinia = createPinia()\n\n  app.use(pinia)\n  return { app, pinia }\n}"
    },
    {
      "id": "s2-34",
      "sectionId": "s2",
      "title": "SSR 支持",
      "kind": "text",
      "body": "明白了，让我们来结合 `pinia-plugin-persist` 插件完善 Pinia 备忘清单。"
    },
    {
      "id": "s2-35",
      "sectionId": "s2",
      "title": "使用 Vue Devtools",
      "kind": "text",
      "body": "Pinia 可以与 Vue Devtools 一起使用。确保你安装了最新版本的 Vue Devtools，然后你可以在 Devtools 中查看和调试你的 Pinia store。"
    },
    {
      "id": "s2-36",
      "sectionId": "s2",
      "title": "使用异步 Actions",
      "kind": "text",
      "body": "Pinia 支持在 actions 中使用异步代码："
    },
    {
      "id": "s2-37",
      "sectionId": "s2",
      "title": "使用异步 Actions",
      "kind": "code",
      "lang": "javascript",
      "code": "// src/stores/todo.js\nimport { defineStore } from 'pinia'\nimport axios from 'axios'\n\nexport const useTodoStore = defineStore('todo', {\n  state: () => ({\n    todos: []\n  }),\n  actions: {\n    async fetchTodos() {\n      const response = await axios.get('/api/todos')\n      this.todos = response.data\n    }\n  }\n})"
    },
    {
      "id": "s2-38",
      "sectionId": "s2",
      "title": "测试 Pinia Store",
      "kind": "text",
      "body": "你可以使用 Vue Test Utils 和 Jest 来测试你的 Pinia store："
    },
    {
      "id": "s2-39",
      "sectionId": "s2",
      "title": "测试 Pinia Store",
      "kind": "code",
      "lang": "javascript",
      "code": "// __tests__/counterStore.test.js\nimport { setActivePinia, createPinia } from 'pinia'\nimport { useCounterStore } from '@/stores/counter'\n\ndescribe('Counter Store', () => {\n  beforeEach(() => {\n    setActivePinia(createPinia())\n  })\n\n  it('increments the count', () => {\n    const counterStore = useCounterStore()\n    expect(counterStore.count).toBe(0)\n    counterStore.increment()\n    expect(counterStore.count).toBe(1)\n  })\n\n  it('returns double count', () => {\n    const counterStore = useCounterStore()\n    counterStore.count = 2\n    expect(counterStore.doubleCount).toBe(4)\n  })\n})"
    },
    {
      "id": "s3-40",
      "sectionId": "s3",
      "title": "另见",
      "kind": "text",
      "body": "• [Pinia 官方文档](https://pinia.vuejs.org/)\n• [Pinia GitHub 仓库](https://github.com/vuejs/pinia)\n• [Pinia 快速上手](https://pinia.vuejs.org/getting-started.html)\n• [pinia-plugin-persist 官方文档](https://seb-l.github.io/pinia-plugin-persist/basic-usage.html)"
    }
  ],
  "source": {
    "repo": "https://github.com/jaywcjlove/reference",
    "path": "docs/pinia.md",
    "ref": "main",
    "url": "https://github.com/jaywcjlove/reference/tree/main/docs/pinia.md",
    "lang": "zh",
    "mode": "local"
  }
}