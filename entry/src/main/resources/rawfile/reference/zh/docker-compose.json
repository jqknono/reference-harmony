{
  "id": "docker-compose",
  "name": "Docker Compose 备忘清单",
  "title": "这是 [docker-compose](https://docs.docker.com/compose/) 的快速参考备忘单。你可以在这里找到最常见的 Docker Compose 使用方式。",
  "icon": "reference/icons/zh/docker-compose.svg",
  "sections": [
    {
      "id": "intro",
      "title": "简介",
      "startIndex": 0
    },
    {
      "id": "s1",
      "title": "入门",
      "startIndex": 1
    },
    {
      "id": "s2",
      "title": "Docker Compose 配置",
      "startIndex": 32
    }
  ],
  "cards": [
    {
      "id": "intro-0",
      "sectionId": "intro",
      "title": "简介",
      "body": "这是 [docker-compose](https://docs.docker.com/compose/) 的快速参考备忘单。你可以在这里找到最常见的 Docker Compose 使用方式。"
    },
    {
      "id": "s1-1",
      "sectionId": "s1",
      "title": "Docker Compose 是什么？",
      "body": "• **Docker Compose** 是由 [Docker](./docker.md) 社区维护的开源工具，用于定义和运行多容器应用。\n• 通过单个 [YAML](./yaml.md) 文件配置服务，可用一条命令启动、停止或重启整个应用。\n• [Docker Compose 开源地址](https://github.com/docker/compose)\n• [Docker Compose 发行地址](https://github.com/docker/compose/releases) _github.com_"
    },
    {
      "id": "s1-2",
      "sectionId": "s1",
      "title": "基本概念",
      "body": "• **服务 (services):** 一个服务指的是一个容器，即一个应用程序的一个实例。\n• **容器 (container):** [Docker](./docker.md) 容器，其中运行着应用程序的一个实例。\n• **镜像 (image):** [Docker](./docker.md) 镜像，用于创建容器的模板。\n• **Docker-Compose 文件：** 一个 [YAML](./yaml.md) 文件，描述了应用程序的各个服务以及它们之间的关系、配置等信息。"
    },
    {
      "id": "s1-3",
      "sectionId": "s1",
      "title": "Docker-Compose 文件结构",
      "body": "• `version`: _Docker-Compose_ 文件的版本。\n• `services`: 定义了各个服务，每个服务都有自己的配置项，如镜像、端口映射、依赖等。\n• `networks`: 定义了应用程序使用的网络，可以自定义网络以控制服务之间的通信。\n• `volumes`: 定义了应用程序使用的卷，用于持久化数据或与主机共享文件。"
    },
    {
      "id": "s1-4",
      "sectionId": "s1",
      "title": "安装",
      "body": "Docker 20.10 起，CLI 支持插件机制，官方已将 Compose 迁移为 CLI 插件。推荐使用 `docker compose`（空格，无横线），旧项目如需兼容 `docker-compose` 可安装 `docker-compose-plugin` 或使用软链接。\n\n```bash\nsudo ln -s /usr/lib/docker/cli-plugins/docker-compose /usr/local/bin/docker-compose\n```\n\n对于 Ubuntu 和 Debian，运行：\n\n```bash\nsudo apt-get update\nsudo apt-get install docker-compose-plugin\n```\n\n对于基于 RPM 的发行版，运行：\n\n```bash\nsudo yum update\nsudo yum install docker-compose-plugin\n```\n\n通过检查版本来验证 Docker Compose 是否正确安装\n\n```sh\ndocker compose version\n# Docker Compose version v2.17.3\n\ndocker --version\n# Docker version 23.0.5, build bc4487a\n\ndocker version\n# Client: Docker Engine - Community\n# Cloud integration: v1.0.31\n# Version:           23.0.5\n# API version:       1.42\n# <...>\n```"
    },
    {
      "id": "s1-12",
      "sectionId": "s1",
      "title": "独立安装 Compose",
      "body": "```sh\ncurl -SL https://github.com/docker/compose/releases/download/v2.27.0/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose\n```\n\n如果命令 `docker-compose` 安装失败，请检查你的路径。你也可以创建一个符号链接，指向 `/usr/bin` 或路径中的任何其他目录。例如\n\n```sh\n$ sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n```"
    },
    {
      "id": "s1-15",
      "sectionId": "s1",
      "title": "更新 Compose",
      "body": "对于 Ubuntu 和 Debian，运行：\n\n```sh\nsudo apt-get update\nsudo apt-get install docker-compose-plugin\n```\n\n对于基于 RPM 的发行版，运行：\n\n```sh\nsudo yum update\nsudo yum install docker-compose-plugin\n```"
    },
    {
      "id": "s1-19",
      "sectionId": "s1",
      "title": "卸载 Docker Compose",
      "body": "Ubuntu, Debian:\n\n```sh\nsudo apt-get remove docker-compose-plugin\n```\n\n基于 RPM 的发行版\n\n```sh\nsudo yum remove docker-compose-plugin\n```\n\n如果您使用curl安装Compose CLI插件，要卸载它，请运行：\n\n```sh\nrm $DOCKER_CONFIG/cli-plugins/docker-compose\n```\n\n为所有用户删除，或者，如果您已为所有用户安装 Compose，请运行：\n\n```sh\nrm /usr/local/lib/docker/cli-plugins/docker-compose\n```"
    },
    {
      "id": "s1-27",
      "sectionId": "s1",
      "title": "%E6%A3%80%E6%9F%A5%20Compose%20%E7%9A%84%E5%AE%89%E8%A3%85%E4%BD%8D%E7%BD%AE",
      "body": "%60%60%60sh%0Adocker%20info%20--format%20'%7B%7Brange%20.ClientInfo.Plugins%7D%7D%7B%7Bif%20eq%20.Name%20%22compose%22%7D%7D%7B%7B.Path%7D%7D%7B%7Bend%7D%7D%7B%7Bend%7D%7D'%0A%60%60%60",
      "encoded": true
    },
    {
      "id": "s1-28",
      "sectionId": "s1",
      "title": "常用命令",
      "body": "| docker compose命令       | 说明             | 常见参数说明         |\n| ------------------------ | ---------------- | -------------------- |\n| `docker compose up`      | 启动容器         | `-d` 后台运行容器    |\n| `docker compose down`    | 停止容器         | `-v` 删除容器和卷    |\n| `docker compose logs`    | 查看容器日志     | `-f` 跟随日志输出    |\n| `docker compose exec`    | 进入容器         | `-it` 启动交互式终端 |\n| `docker compose pull`    | 拉取镜像         |                      |\n| `docker compose build`   | 构建镜像         |                      |\n| `docker compose images`  | 列出镜像         |                      |\n| `docker compose push`    | 推送镜像         |                      |\n| `docker compose config`  | 显示配置信息     |                      |\n| `docker compose version` | 查看版本信息     |                      |"
    },
    {
      "id": "s1-29",
      "sectionId": "s1",
      "title": "常用运维命令",
      "body": "| docker compose命令       | 说明             |\n| ------------------------ | ---------------- |\n| `docker compose stop`    | 停止容器         |\n| `docker compose start`   | 启动容器         |\n| `docker compose rm`      | 删除容器         |\n| `docker compose restart` | 重启容器         |\n| `docker compose run`     | 运行一个临时容器 |\n| `docker compose ps`      | 查看容器状态     |"
    },
    {
      "id": "s1-30",
      "sectionId": "s1",
      "title": "其他命令",
      "body": "```bash\ndocker compose up -d --remove-orphans --pull always --force-recreate\n```\n\n| 参数 | 说明|\n|-----|----|\n| `-d / --detach`     | 后台运行容器。|\n| `--remove-orphans`  | 删除孤儿容器和网络配置。|\n| `--pull always`     | 每次启动前都从远程仓库拉取最新镜像，确保使用最新镜像，而不是本地缓存。还可以用--pull missing（只拉不存在的镜像）或 --pull never（不拉取）。|\n| `--force-recreate`  | 强制重新创建容器，即使配置或镜像没有变化。|"
    },
    {
      "id": "s2-32",
      "sectionId": "s2",
      "title": "%E7%A4%BA%E4%BE%8B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6",
      "body": "%60docker-compose%60%20%E4%BD%BF%E7%94%A8%20%5BYAML%5D(.%2Fyaml.md)%20%E6%96%87%E4%BB%B6%E5%AE%9A%E4%B9%89%E5%92%8C%E8%BF%90%E8%A1%8C%E5%A4%9A%E5%AE%B9%E5%99%A8%E5%BA%94%E7%94%A8%EF%BC%8C%E9%80%9A%E5%B8%B8%E5%91%BD%E5%90%8D%E4%B8%BA%20%60docker-compose.yml%60%EF%BC%88%E6%96%B0%E7%89%88%E6%9C%AC%E5%BB%BA%E8%AE%AE%E7%94%A8%20%60compose.yaml%60%EF%BC%89%E3%80%82%0A%E8%AF%A5%E6%96%87%E4%BB%B6%E9%9B%86%E4%B8%AD%E6%8F%8F%E8%BF%B0%E5%A4%9A%E4%B8%AA%E5%AE%B9%E5%99%A8%E7%9A%84%E6%9C%8D%E5%8A%A1%E3%80%81%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E7%AD%89%E3%80%82%E4%B8%8B%E9%9D%A2%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8C%85%E5%90%AB%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E9%A1%B9%E5%92%8C%E8%AF%B4%E6%98%8E%E7%9A%84%E6%A8%A1%E6%9D%BF%EF%BC%9A%0A%0A%60%60%60yml%0Aname%3A%20myapp%0Aversion%3A%20'3'%20%23%20%E5%B7%B2%E8%BF%87%E6%97%B6%0A%0Aservices%3A%20%20%23%20%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E6%88%96%E5%A4%9A%E4%B8%AA%E6%9C%8D%E5%8A%A1%0A%20%20service1%3A%20%20%23%20%E6%9C%8D%E5%8A%A1%E5%90%8D%E7%A7%B0%0A%20%20%20%20image%3A%20nginx%3Alatest%20%20%23%20%E4%BD%BF%E7%94%A8%E7%9A%84%20Docker%20%E9%95%9C%E5%83%8F%EF%BC%8C%E8%BF%99%E9%87%8C%E6%98%AF%20Nginx%20%E7%9A%84%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%0A%20%20%20%20%23%20%E6%88%96%E8%80%85%E4%BD%BF%E7%94%A8%E6%9E%84%E5%BB%BA%E6%8C%87%E4%BB%A4%E6%9D%A5%E4%BB%8E%20Dockerfile%20%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%0A%20%20%20%20build%3A%0A%20%20%20%20%20%20context%3A%20.%2Fpath%2Fto%2FDockerfile%20%20%23%20Dockerfile%20%E6%89%80%E5%9C%A8%E7%9A%84%E7%9B%AE%E5%BD%95%0A%20%20%20%20%20%20dockerfile%3A%20Dockerfile-alternative%20%20%23%20%E5%8F%AF%E9%80%89%E7%9A%84%20Dockerfile%20%E5%90%8D%E7%A7%B0%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AF%20Dockerfile%0A%20%20%20%20%23%20%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E6%97%B6%E6%89%A7%E8%A1%8C%E7%9A%84%E5%91%BD%E4%BB%A4%EF%BC%8C%E8%A6%86%E7%9B%96%E9%BB%98%E8%AE%A4%E7%9A%84%E5%91%BD%E4%BB%A4%0A%20%20%20%20command%3A%20%0A%20%20%20%20%20%20-%20%22nginx%22%0A%20%20%20%20%20%20-%20%22-g%22%0A%20%20%20%20%20%20-%20%22daemon%20off%3B%22%20%20%23%20%E4%BB%A5%E6%95%B0%E7%BB%84%E5%BD%A2%E5%BC%8F%E6%8C%87%E5%AE%9A%EF%BC%8C%E9%98%B2%E6%AD%A2%20shell%20%E8%A7%A3%E6%9E%90%0A%20%20%20%20ports%3A%20%20%20%20%20%20%20%23%20%E5%AE%B9%E5%99%A8%E7%AB%AF%E5%8F%A3%E4%B8%8E%E4%B8%BB%E6%9C%BA%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%0A%20%20%20%20%20%20-%20%2280%3A80%22%20%20%23%20%E4%B8%BB%E6%9C%BA%2080%20%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E5%88%B0%E5%AE%B9%E5%99%A8%E7%9A%84%2080%20%E7%AB%AF%E5%8F%A3%0A%0A%20%20%20%20volumes%3A%20%20%23%20%E6%95%B0%E6%8D%AE%E5%8D%B7%E6%8C%82%E8%BD%BD%0A%20%20%20%20%20%20-%20.%2Fnginx.conf%3A%2Fetc%2Fnginx%2Fnginx.conf%3Aro%20%20%23%20%E5%B0%86%E4%B8%BB%E6%9C%BA%E4%B8%8A%E7%9A%84%20nginx.conf%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E6%8C%82%E8%BD%BD%E5%88%B0%E5%AE%B9%E5%99%A8%E7%9A%84%20%2Fetc%2Fnginx%2Fnginx.conf%EF%BC%8C%E5%8F%AA%E8%AF%BB%0A%20%20%20%20%20%20-%20.%2Flogs%3A%2Fvar%2Flog%2Fnginx%20%20%23%20%E5%B0%86%20logs%20%E7%9B%AE%E5%BD%95%E6%8C%82%E8%BD%BD%E5%88%B0%E5%AE%B9%E5%99%A8%E7%9A%84%20%2Fvar%2Flog%2Fnginx%0A%20%20%20%20environment%3A%20%20%23%20%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%0A%20%20%20%20%20%20-%20MYSQL_HOST%3Ddatabase%20%20%23%20%E5%8F%AF%E4%BB%A5%E5%BC%95%E7%94%A8%E5%85%B6%E4%BB%96%E6%9C%8D%E5%8A%A1%EF%BC%8C%E8%BF%99%E9%87%8C%E5%81%87%E8%AE%BE%E6%9C%89%E4%B8%80%E4%B8%AA%E5%90%8D%E4%B8%BA%20database%20%E7%9A%84%E6%9C%8D%E5%8A%A1%0A%20%20%20%20%20%20-%20MYSQL_PORT%3D3306%0A%20%20%20%20depends_on%3A%20%20%23%20%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E9%A1%BA%E5%BA%8F%EF%BC%8C%E8%BF%99%E9%87%8C%E8%A1%A8%E6%98%8E%20service1%20%E4%BE%9D%E8%B5%96%E4%BA%8E%20database%20%E6%9C%8D%E5%8A%A1%0A%20%20%20%20%20%20-%20database%0A%20%20%20%20networks%3A%20%20%23%20%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C%0A%20%20%20%20%20%20-%20my_network%20%20%23%20%E5%8F%82%E4%B8%8E%E5%90%8D%E4%B8%BA%20my_network%20%E7%9A%84%E7%BD%91%E7%BB%9C%0A%0A%20%20service2%3A%20%20%23%20%E5%8F%A6%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1%E7%A4%BA%E4%BE%8B%0A%20%20%20%20%23%20...%20%E7%B1%BB%E4%BC%BC%E5%9C%B0%E5%AE%9A%E4%B9%89%E5%85%B6%E4%BB%96%E6%9C%8D%E5%8A%A1%0A%0Anetworks%3A%20%20%20%20%20%20%20%23%20%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C%0A%20%20my_network%3A%20%20%23%20%E7%BD%91%E7%BB%9C%E5%90%8D%E7%A7%B0%0A%20%20%20%20driver%3A%20bridge%20%20%23%20%E7%BD%91%E7%BB%9C%E9%A9%B1%E5%8A%A8%EF%BC%8C%E9%80%9A%E5%B8%B8%E6%98%AF%20bridge%20%E6%A8%A1%E5%BC%8F%0A%0Avolumes%3A%20%20%23%20%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E5%8D%B7%0A%20%20nginx_logs%3A%20%20%23%20%E5%8D%B7%E5%90%8D%E7%A7%B0%0A%0A%60%60%60%0A%0A%E5%A4%87%E5%BF%98%E5%BD%95%E4%BA%8B%E9%A1%B9%0A%0A%E2%80%A2%20%E4%BD%BF%E7%94%A8%20Docker-Compose%20%E5%8F%AF%E4%BB%A5%E7%AE%80%E5%8C%96%E5%A4%9A%E5%AE%B9%E5%99%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E9%83%A8%E7%BD%B2%E5%92%8C%E7%AE%A1%E7%90%86%EF%BC%8C%E4%BD%86%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E5%AE%B9%E5%99%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E5%92%8C%E9%80%9A%E4%BF%A1%E3%80%82%0A%E2%80%A2%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E7%BC%A9%E8%BF%9B%E5%BF%85%E9%A1%BB%E4%BD%BF%E7%94%A8%E7%A9%BA%E6%A0%BC%EF%BC%8C%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8%E5%88%B6%E8%A1%A8%E7%AC%A6%E3%80%82%0A%E2%80%A2%20%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%9D%A5%E5%8A%A8%E6%80%81%E8%AE%BE%E7%BD%AE%E9%85%8D%E7%BD%AE%E9%A1%B9%EF%BC%8C%E5%A6%82%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%86%E7%A0%81%E3%80%82%0A%E2%80%A2%20%E5%BD%93%E4%BD%A0%E4%BF%AE%E6%94%B9%E4%BA%86%20%60docker-compose.yml%60%20%E6%96%87%E4%BB%B6%E5%90%8E%EF%BC%8C%E9%9C%80%E8%A6%81%E9%87%8D%E6%96%B0%E8%BF%90%E8%A1%8C%20%60docker%20compose%20up%60%20%E6%9D%A5%E4%BD%BF%E6%94%B9%E5%8A%A8%E7%94%9F%E6%95%88%E3%80%82%0A%E2%80%A2%20%E4%BD%BF%E7%94%A8%20%60docker%20compose%20build%60%20%E4%BB%85%E9%87%8D%E5%BB%BA%E9%95%9C%E5%83%8F%EF%BC%8C%E8%80%8C%E4%B8%8D%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8%E3%80%82%0A%E2%80%A2%20%E4%BD%BF%E7%94%A8%20%60docker%20compose%20restart%60%20%E9%87%8D%E5%90%AF%E5%AE%B9%E5%99%A8%E3%80%82%0A%E2%80%A2%20%E8%AE%B0%E5%BE%97%E6%B8%85%E7%90%86%E4%B8%8D%E5%86%8D%E9%9C%80%E8%A6%81%E7%9A%84%E5%AE%B9%E5%99%A8%E5%92%8C%E9%95%9C%E5%83%8F%EF%BC%8C%E4%BB%A5%E9%81%BF%E5%85%8D%E7%A3%81%E7%9B%98%E7%A9%BA%E9%97%B4%E4%B8%8D%E8%B6%B3%E3%80%82",
      "encoded": true
    },
    {
      "id": "s2-36",
      "sectionId": "s2",
      "title": "使用环境变量",
      "body": "与 `docker run -e VARIABLE=VALUE ...` 相同\n\n```yml\nweb:\n  environment:\n    - DEBUG=1\n```\n\n您可以选择不设置值并将环境变量从 shell 直接传递到容器。它的工作方式与 `docker run -e VARIABLE ...` 相同：\n\n```yml\nweb:\n  environment:\n    - DEBUG\nweb:\n  environment:\n    - DEBUG=${DEBUG}\n```\n\n`env_file` 属性允许您在 Compose 应用程序中使用多个 `.env` 文件。\n它的工作方式与 `docker run --env-file=FILE ...` 相同。\n\n```yml\nweb:\n  env_file:\n    - web-variables.env\n```"
    },
    {
      "id": "s2-42",
      "sectionId": "s2",
      "title": "额外的信息",
      "body": "```yml\nenv_file:\n  - path: ./default.env\n    required: true # default\n  - path: ./override.env\n    required: false\n```\n\n• 如果指定了多个文件，则它们将按顺序进行评估，可以覆盖先前文件中设置的值。\n• 在 `.env` 文件中声明的环境变量不能在 Compose 文件中单独再次引用。\n• 如果同时使用 `env_file` 和 `environment` 属性，则由 `environment` 设置的环境变量优先级更高。\n• 在 `env_file` 属性中指定的 `.env` 文件的路径是相对于 compose.yml 文件的位置的。\n• `.env` 文件中的值可以通过使用 `docker compose run -e` 命令行来从命令行覆盖。\n• 如果使用 `--env-file` 替换了另一个 `.env`，则您的 `.env` 文件可以被另一个 `.env` 文件覆盖。\n• 从 Docker Compose 版本 2.24.0 开始，您可以通过使用 `required` 字段将 `.env` 文件设置为可选项。当 `required` 设置为 `false` 且 `.env` 文件丢失时，Compose 将静默忽略该条目"
    },
    {
      "id": "s2-44",
      "sectionId": "s2",
      "title": "image",
      "body": "```yml\nimage: redis\nimage: redis:5\nimage: redis@sha256:0ed5d5928d473745...\nimage: library/redis\nimage: docker.io/library/redis\nimage: my_private.registry:5000/redis\n```"
    },
    {
      "id": "s2-45",
      "sectionId": "s2",
      "title": "ports%20%E7%AB%AF%E5%8F%A3",
      "body": "%60%60%60yml%0Aports%3A%0A%20%20%23%20%E5%B0%86%E5%AE%B9%E5%99%A8%E7%9A%84%E7%AB%AF%E5%8F%A3%203000%20%E6%98%A0%E5%B0%84%E5%88%B0%E4%B8%BB%E6%9C%BA%E7%9A%84%E9%9A%8F%E6%9C%BA%E7%AB%AF%E5%8F%A3%0A%20%20-%20%223000%22%0A%20%20%23%20%E5%B0%86%E5%AE%B9%E5%99%A8%E7%9A%84%E7%AB%AF%E5%8F%A3%E8%8C%83%E5%9B%B4%E4%BB%8E%203000%20%E5%88%B0%203005%20%E6%98%A0%E5%B0%84%E5%88%B0%E4%B8%BB%E6%9C%BA%E7%9A%84%E7%9B%B8%E5%90%8C%E7%AB%AF%E5%8F%A3%E8%8C%83%E5%9B%B4%0A%20%20-%20%223000-3005%22%0A%20%20%23%20%E5%B0%86%E5%AE%B9%E5%99%A8%E7%9A%84%E7%AB%AF%E5%8F%A3%208000%20%E6%98%A0%E5%B0%84%E5%88%B0%E4%B8%BB%E6%9C%BA%E7%9A%84%E7%AB%AF%E5%8F%A3%208000%0A%20%20-%20%228000%3A8000%22%0A%20%20%23%20%E5%B0%86%E5%AE%B9%E5%99%A8%E7%9A%84%E7%AB%AF%E5%8F%A3%E8%8C%83%E5%9B%B4%E4%BB%8E%208080%20%E5%88%B0%208081%20%E6%98%A0%E5%B0%84%E5%88%B0%E4%B8%BB%E6%9C%BA%E7%9A%84%E7%AB%AF%E5%8F%A3%E8%8C%83%E5%9B%B4%E4%BB%8E%209090%20%E5%88%B0%209091%0A%20%20-%20%229090-9091%3A8080-8081%22%0A%20%20%23%20%E5%B0%86%E5%AE%B9%E5%99%A8%E7%9A%84%E7%AB%AF%E5%8F%A3%2022%EF%BC%88SSH%E7%AB%AF%E5%8F%A3%EF%BC%89%E6%98%A0%E5%B0%84%E5%88%B0%E4%B8%BB%E6%9C%BA%E7%9A%84%E7%AB%AF%E5%8F%A3%2049100%0A%20%20-%20%2249100%3A22%22%0A%20%20%23%20%E5%B0%86%E5%AE%B9%E5%99%A8%E7%9A%84%E7%AB%AF%E5%8F%A3%E8%8C%83%E5%9B%B4%E4%BB%8E%208000%20%E5%88%B0%209000%20%E6%98%A0%E5%B0%84%E5%88%B0%E4%B8%BB%E6%9C%BA%E7%9A%84%E7%AB%AF%E5%8F%A3%2080%0A%20%20-%20%228000-9000%3A80%22%0A%20%20%23%20%E5%B0%86%E5%AE%B9%E5%99%A8%E7%9A%84%E7%AB%AF%E5%8F%A3%208001%20%E6%98%A0%E5%B0%84%E5%88%B0%E4%B8%BB%E6%9C%BA%E7%9A%84%20127.0.0.1%20%E5%9C%B0%E5%9D%80%E7%9A%84%E7%AB%AF%E5%8F%A3%208001%0A%20%20-%20%22127.0.0.1%3A8001%3A8001%22%0A%20%20%23%20%E5%B0%86%E5%AE%B9%E5%99%A8%E7%9A%84%E7%AB%AF%E5%8F%A3%E8%8C%83%E5%9B%B4%E4%BB%8E%205000%20%E5%88%B0%205010%20%E6%98%A0%E5%B0%84%E5%88%B0%E4%B8%BB%E6%9C%BA%E7%9A%84%20127.0.0.1%20%E5%9C%B0%E5%9D%80%E7%9A%84%E7%9B%B8%E5%90%8C%E7%AB%AF%E5%8F%A3%E8%8C%83%E5%9B%B4%0A%20%20-%20%22127.0.0.1%3A5000-5010%3A5000-5010%22%0A%20%20%23%20%E5%B0%86%E5%AE%B9%E5%99%A8%E7%9A%84%20UDP%20%E7%AB%AF%E5%8F%A3%206060%20%E6%98%A0%E5%B0%84%E5%88%B0%E4%B8%BB%E6%9C%BA%E7%9A%84%E7%AB%AF%E5%8F%A3%206060%0A%20%20-%20%226060%3A6060%2Fudp%22%0A%60%60%60%0A%0A%E6%9A%B4%E9%9C%B2%E5%AE%B9%E5%99%A8%E7%AB%AF%E5%8F%A3",
      "encoded": true
    },
    {
      "id": "s2-47",
      "sectionId": "s2",
      "title": "platform 平台",
      "body": "```yml\nplatform: darwin\nplatform: windows/amd64\nplatform: linux/arm64/v8\n```\n\n定义了服务容器运行的目标平台。值必须符合 [OCI Image Spec](https://github.com/opencontainers/image-spec/blob/v1.0.2/image-index.md) 使用的约定"
    },
    {
      "id": "s2-49",
      "sectionId": "s2",
      "title": "command",
      "body": "%E4%BC%9A%E8%A6%86%E7%9B%96%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%A3%B0%E6%98%8E%E7%9A%84%E9%BB%98%E8%AE%A4%E5%91%BD%E4%BB%A4%EF%BC%8C%E4%BE%8B%E5%A6%82%20Dockerfile%20%E7%9A%84%20CMD%E3%80%82%0A%0A%60%60%60yml%0Acommand%3A%20bundle%20exec%20thin%20-p%203000%0A%60%60%60%0A%0A%E8%AF%A5%E5%80%BC%E4%B9%9F%E5%8F%AF%E4%BB%A5%E6%98%AF%E4%B8%80%E4%B8%AA%E5%88%97%E8%A1%A8%EF%BC%8C%E5%85%B6%E6%96%B9%E5%BC%8F%E7%B1%BB%E4%BC%BC%E4%BA%8E%20Dockerfile%EF%BC%9A%0A%0A%60%60%60yml%0Acommand%3A%20%5B%20%22bundle%22%2C%20%22exec%22%2C%20%22thin%22%2C%20%22-p%22%2C%20%223000%22%20%5D%0A%60%60%60%0A%0A%E5%A6%82%E6%9E%9C%E8%AF%A5%E5%80%BC%E4%B8%BA%20null%EF%BC%8C%E5%88%99%E4%BD%BF%E7%94%A8%E6%98%A0%E5%83%8F%E4%B8%AD%E7%9A%84%E9%BB%98%E8%AE%A4%E5%91%BD%E4%BB%A4%E3%80%82%E5%A6%82%E6%9E%9C%E5%80%BC%E4%B8%BA%20%5B%5D%EF%BC%88%E7%A9%BA%E5%88%97%E8%A1%A8%EF%BC%89%E6%88%96%20''%EF%BC%88%E7%A9%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89%EF%BC%8C%E5%88%99%E5%BF%BD%E7%95%A5%E5%9B%BE%E5%83%8F%E5%A3%B0%E6%98%8E%E7%9A%84%E9%BB%98%E8%AE%A4%E5%91%BD%E4%BB%A4%EF%BC%8C%E5%8D%B3%E8%A6%86%E7%9B%96%E4%B8%BA%E7%A9%BA%E3%80%82",
      "encoded": true
    },
    {
      "id": "s2-54",
      "sectionId": "s2",
      "title": "depends_on",
      "body": "```yml\nservices:\n  web:\n    build: .\n    depends_on:\n      - db\n      - redis\n  redis:\n    image: redis\n  db:\n    image: postgres\n```\n\n服务之间的启动和关闭依赖关系。"
    },
    {
      "id": "s2-56",
      "sectionId": "s2",
      "title": "volumes",
      "body": "下面的示例显示了双服务设置，其中数据库的数据目录作为名为 db-data 的卷与另一个服务共享，以便定期备份。\n\n```yml\nservices:\n  backend:\n    image: example/database\n    volumes:\n      - db-data:/etc/data\n\n  backup:\n    image: backup-service\n    volumes:\n      - db-data:/var/lib/backup/data\n\nvolumes:\n  db-data:\n```\n\ndb-data 卷安装在 `/var/lib/backup/data` 和 `/etc/data` 容器路径中，分别用于备份和后端。如果卷尚不存在，则运行 `docker compose up` 会创建该卷。否则，如果在 Compose 外部手动删除现有卷，则会使用并重新创建现有卷。"
    },
    {
      "id": "s2-59",
      "sectionId": "s2",
      "title": "driver",
      "body": "指定应使用哪个卷驱动程序。如果驱动程序不可用，Compose 将返回错误并且不会部署应用程序。\n\n```yml\nvolumes:\n  db-data:\n    driver: foobar\n```"
    },
    {
      "id": "s2-61",
      "sectionId": "s2",
      "title": "driver_opts",
      "body": "%E6%8C%87%E5%AE%9A%E4%B8%80%E4%B8%AA%E9%80%89%E9%A1%B9%E5%88%97%E8%A1%A8%EF%BC%8C%E4%BD%9C%E4%B8%BA%E9%94%AE%E5%80%BC%E5%AF%B9%E4%BC%A0%E9%80%92%E7%BB%99%E6%AD%A4%E5%8D%B7%E7%9A%84%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F%E3%80%82%E8%BF%99%E4%BA%9B%E9%80%89%E9%A1%B9%E5%8F%96%E5%86%B3%E4%BA%8E%E9%A9%BE%E9%A9%B6%E5%91%98%E3%80%82%0A%0A%60%60%60yml%0Avolumes%3A%0A%20%20example%3A%0A%20%20%20%20driver_opts%3A%0A%20%20%20%20%20%20type%3A%20%22nfs%22%0A%20%20%20%20%20%20o%3A%20%22addr%3D10.40.0.199%2Cnolock%2Csoft%2Crw%22%0A%20%20%20%20%20%20device%3A%20%22%3A%2Fdocker%2Fexample%22%0A%60%60%60",
      "encoded": true
    },
    {
      "id": "s2-63",
      "sectionId": "s2",
      "title": "external",
      "body": "```yml\nservices:\n  backend:\n    image: example/database\n    volumes:\n      - db-data:/etc/data\n\nvolumes:\n  db-data:\n    external: true\n```\n\n在示例中，Compose 不会尝试创建名为 `{project_name}_db-data` 的卷，而是查找名为 `db-data` 的现有卷，并将其挂载到后端服务的容器中。"
    },
    {
      "id": "s2-65",
      "sectionId": "s2",
      "title": "labels",
      "body": "%E6%A0%87%E7%AD%BE%E7%94%A8%E4%BA%8E%E5%B0%86%E5%85%83%E6%95%B0%E6%8D%AE%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%8D%B7%E4%B8%AD%E3%80%82%E6%82%A8%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E6%95%B0%E7%BB%84%E6%88%96%E5%AD%97%E5%85%B8%E3%80%82%0A%0A%60%60%60yml%0Avolumes%3A%0A%20%20db-data%3A%0A%20%20%20%20labels%3A%0A%20%20%20%20%20%20com.example.description%3A%20%22Database%20volume%22%0A%20%20%20%20%20%20com.example.department%3A%20%22IT%2FOps%22%0A%20%20%20%20%20%20com.example.label-with-empty-value%3A%20%22%22%0A%60%60%60%0A%0A%60%60%60yml%0Avolumes%3A%0A%20%20db-data%3A%0A%20%20%20%20labels%3A%0A%20%20%20%20%20%20-%20%22com.demo.description%3DDatabase%20volume%22%0A%20%20%20%20%20%20-%20%22com.demo.department%3DIT%2FOps%22%0A%20%20%20%20%20%20-%20%22com.demo.label-with-empty-value%22%0A%60%60%60",
      "encoded": true
    },
    {
      "id": "s2-67",
      "sectionId": "s2",
      "title": "name",
      "body": "%E8%AE%BE%E7%BD%AE%E5%8D%B7%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E5%90%8D%E7%A7%B0%E3%80%82%E5%90%8D%E7%A7%B0%E5%AD%97%E6%AE%B5%E5%8F%AF%E7%94%A8%E4%BA%8E%E5%BC%95%E7%94%A8%E5%8C%85%E5%90%AB%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%9A%84%E5%8D%B7%E3%80%82%E8%AF%A5%E5%90%8D%E7%A7%B0%E6%8C%89%E5%8E%9F%E6%A0%B7%E4%BD%BF%E7%94%A8%EF%BC%8C%E5%B9%B6%E4%B8%94%E4%B8%8D%E5%8F%97%E5%A0%86%E6%A0%88%E5%90%8D%E7%A7%B0%E7%9A%84%E9%99%90%E5%88%B6%E3%80%82%0A%0A%60%60%60yml%0Avolumes%3A%0A%20%20db-data%3A%0A%20%20%20%20name%3A%20%22my-app-data%22%0A%60%60%60%0A%0A%E8%BF%99%E4%BD%BF%E5%BE%97%E5%8F%AF%E4%BB%A5%E5%B0%86%E6%AD%A4%E6%9F%A5%E6%89%BE%E5%90%8D%E7%A7%B0%E4%BD%9C%E4%B8%BA%20Compose%20%E6%96%87%E4%BB%B6%E7%9A%84%E5%8F%82%E6%95%B0%EF%BC%8C%E4%BB%A5%E4%BE%BF%E5%8D%B7%E7%9A%84%E6%A8%A1%E5%9E%8B%20ID%20%E8%A2%AB%E7%A1%AC%E7%BC%96%E7%A0%81%EF%BC%8C%E4%BD%86%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84%E5%AE%9E%E9%99%85%E5%8D%B7%20ID%20%E6%98%AF%E5%9C%A8%E9%83%A8%E7%BD%B2%E6%9C%9F%E9%97%B4%E5%9C%A8%E8%BF%90%E8%A1%8C%E6%97%B6%E8%AE%BE%E7%BD%AE%E7%9A%84%E3%80%82%E4%BE%8B%E5%A6%82%EF%BC%8C%E5%A6%82%E6%9E%9C%20%60.env%60%20%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%20%60DATABASE_VOLUME%3Dmy_volume_001%60%EF%BC%9A%0A%0A%60%60%60yml%0Avolumes%3A%0A%20%20db-data%3A%0A%20%20%20%20name%3A%20%24%7BDATABASE_VOLUME%7D%0A%60%60%60%0A%0A%E5%AE%83%E8%BF%98%E5%8F%AF%E4%BB%A5%E4%B8%8E%E5%A4%96%E9%83%A8%E5%B1%9E%E6%80%A7%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8%E3%80%82%E8%BF%99%E6%84%8F%E5%91%B3%E7%9D%80%E7%94%A8%E4%BA%8E%E5%9C%A8%E5%B9%B3%E5%8F%B0%E4%B8%8A%E6%9F%A5%E6%89%BE%E5%AE%9E%E9%99%85%E5%8D%B7%E7%9A%84%E5%8D%B7%E5%90%8D%E7%A7%B0%E4%B8%8E%E7%94%A8%E4%BA%8E%E5%9C%A8%20Compose%20%E6%96%87%E4%BB%B6%E4%B8%AD%E5%BC%95%E7%94%A8%E5%AE%83%E7%9A%84%E5%90%8D%E7%A7%B0%E5%88%86%E5%BC%80%E8%AE%BE%E7%BD%AE%EF%BC%9A%0A%0A%60%60%60yml%0Avolumes%3A%0A%20%20db-data%3A%0A%20%20%20%20external%3A%0A%20%20%20%20%20%20name%3A%20actual-name-of-volume%0A%60%60%60",
      "encoded": true
    },
    {
      "id": "s2-73",
      "sectionId": "s2",
      "title": "networks",
      "body": "```yml\nservices:\n  some-service:\n    networks:\n      - some-network\n      - other-network\n```"
    },
    {
      "id": "s2-74",
      "sectionId": "s2",
      "title": "aliases",
      "body": "声明网络上服务的替代主机名。同一网络上的其他容器可以使用服务名称或别名来连接到服务的容器之一\n\n```yml\nservices:\n  some-service:\n    networks:\n      some-network:\n        aliases:\n          - alias1\n          - alias3\n      other-network:\n        aliases:\n          - alias2\n```\n\n在以下示例中，服务前端能够通过主机名 `backend` 或者 `back-tier` 网络上的数据库来访问 `backend` 服务。服务 `monitoring` 能够在 admin 网络上通过主机名 `backend` 或者 `mysql` 来访问相同的 `backend` 服务。\n\n```yml\nservices:\n  frontend:\n    image: example/webapp\n    networks:\n      - front-tier\n      - back-tier\n\n  monitoring:\n    image: example/monitoring\n    networks:\n      - admin\n\n  backend:\n    image: example/backend\n    networks:\n      back-tier:\n        aliases:\n          - database\n      admin:\n        aliases:\n          - mysql\n\nnetworks:\n  front-tier:\n  back-tier:\n  admin:\n```"
    },
    {
      "id": "s2-78",
      "sectionId": "s2",
      "title": "ipv4_address%2C%20ipv6_address",
      "body": "%E5%8A%A0%E5%85%A5%E7%BD%91%E7%BB%9C%E6%97%B6%EF%BC%8C%E4%B8%BA%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8%E6%8C%87%E5%AE%9A%E9%9D%99%E6%80%81IP%E5%9C%B0%E5%9D%80%E3%80%82%0A%0A%60%60%60yml%0Aservices%3A%0A%20%20frontend%3A%0A%20%20%20%20image%3A%20example%2Fwebapp%0A%20%20%20%20networks%3A%0A%20%20%20%20%20%20front-tier%3A%0A%20%20%20%20%20%20%20%20ipv4_address%3A%20172.16.238.10%0A%20%20%20%20%20%20%20%20ipv6_address%3A%202001%3A3984%3A3989%3A%3A10%0A%0Anetworks%3A%0A%20%20front-tier%3A%0A%20%20%20%20ipam%3A%0A%20%20%20%20%20%20driver%3A%20default%0A%20%20%20%20%20%20config%3A%0A%20%20%20%20%20%20%20%20-%20subnet%3A%20%22172.16.238.0%2F24%22%0A%20%20%20%20%20%20%20%20-%20subnet%3A%20%222001%3A3984%3A3989%3A%3A%2F64%22%0A%60%60%60",
      "encoded": true
    },
    {
      "id": "s2-80",
      "sectionId": "s2",
      "title": "link_local_ips",
      "body": "指定了链接本地IP的列表。链路本地IP是属于知名子网的特殊IP，纯粹由运营商管理，通常取决于部署它们的架构。\n\n```yml\nservices:\n  app:\n    image: busybox\n    command: top\n    networks:\n      app_net:\n        link_local_ips:\n          - 57.123.22.11\n          - 57.123.22.13\nnetworks:\n  app_net:\n    driver: bridge\n```"
    },
    {
      "id": "s2-82",
      "sectionId": "s2",
      "title": "mac_address",
      "body": "设置服务容器连接特定网络时使用的 MAC 地址。"
    },
    {
      "id": "s2-83",
      "sectionId": "s2",
      "title": "priority 优先级",
      "body": "将服务的容器连接到其网络的顺序。如果未指定，默认值为 0。在以下示例中，应用服务首先连接到 `app_net_1`，因为它具有最高优先级。然后它连接到 `app_net_3`，然后是 `app_net_2`，后者使用默认优先级值 0。\n\n```yml\nservices:\n  app:\n    image: busybox\n    command: top\n    networks:\n      app_net_1:\n        priority: 1000\n      app_net_2:\n\n      app_net_3:\n        priority: 100\nnetworks:\n  app_net_1:\n  app_net_2:\n  app_net_3:\n```"
    },
    {
      "id": "s2-85",
      "sectionId": "s2",
      "title": "expose",
      "body": "%60%60%60yml%0Aexpose%3A%0A%20%20-%20%223000%22%0A%20%20-%20%228000%22%0A%20%20-%20%228080-8085%2Ftcp%22%0A%60%60%60%0A%0A%E5%AE%9A%E4%B9%89%20Compose%20%E4%BB%8E%E5%AE%B9%E5%99%A8%E5%85%AC%E5%BC%80%E7%9A%84%EF%BC%88%E4%BC%A0%E5%85%A5%EF%BC%89%E7%AB%AF%E5%8F%A3%E6%88%96%E7%AB%AF%E5%8F%A3%E8%8C%83%E5%9B%B4%E3%80%82%E8%BF%99%E4%BA%9B%E7%AB%AF%E5%8F%A3%E5%BF%85%E9%A1%BB%E5%8F%AF%E4%BE%9B%E9%93%BE%E6%8E%A5%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE%EF%BC%8C%E5%B9%B6%E4%B8%94%E4%B8%8D%E5%BA%94%E5%8F%91%E5%B8%83%E5%88%B0%E4%B8%BB%E6%9C%BA%E3%80%82%E5%8F%AA%E8%83%BD%E6%8C%87%E5%AE%9A%E5%86%85%E9%83%A8%E5%AE%B9%E5%99%A8%E7%AB%AF%E5%8F%A3%E3%80%82",
      "encoded": true
    },
    {
      "id": "s2-87",
      "sectionId": "s2",
      "title": "links",
      "body": "```yml\nweb:\n  links:\n    - db\n    - db:database\n    - redis\n```\n\n定义到另一个服务中的容器的网络链接。同时指定服务名称和链接别名 (SERVICE:ALIAS)，或者仅指定服务名称。"
    },
    {
      "id": "s2-89",
      "sectionId": "s2",
      "title": "pids_limit",
      "body": "```yml\npids_limit: 10\n```\n\n调整容器的 PID 限制。设置为 -1 以获取无限 PID。"
    },
    {
      "id": "s2-91",
      "sectionId": "s2",
      "title": "devices",
      "body": "%60%60%60yml%0Adevices%3A%0A%20%20-%20%22%2Fdev%2FttyUSB0%3A%2Fdev%2FttyUSB0%22%0A%20%20-%20%22%2Fdev%2Fsda%3A%2Fdev%2Fxvda%3Arwm%22%0A%60%60%60%0A%0A%E5%AE%9A%E4%B9%89%E5%B7%B2%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8%E7%9A%84%E8%AE%BE%E5%A4%87%E6%98%A0%E5%B0%84%E5%88%97%E8%A1%A8%0A%0A%60%60%60sh%0AHOST_PATH%3ACONTAINER_PATH%5B%3ACGROUP_PERMISSIONS%5D%0A%60%60%60",
      "encoded": true
    },
    {
      "id": "s2-94",
      "sectionId": "s2",
      "title": "dns",
      "body": "```yml\ndns: 8.8.8.8\ndns:\n  - 8.8.8.8\n  - 9.9.9.9\n```\n\n定义在容器网络接口配置上设置的自定义 DNS 服务器。它可以是单个值或列表。"
    },
    {
      "id": "s2-96",
      "sectionId": "s2",
      "title": "dns_opt",
      "body": "```yml\ndns_opt:\n  - use-vc\n  - no-tld-query\n```\n\n列出要传递给容器的 DNS 解析器（Linux 上的 /etc/resolv.conf 文件）的自定义 DNS 选项。"
    },
    {
      "id": "s2-98",
      "sectionId": "s2",
      "title": "dns_search",
      "body": "```yml\ndns_search: example.com\ndns_search:\n  - dc1.example.com\n  - dc2.example.com\n```\n\n定义在容器网络接口配置上设置的自定义 DNS 搜索域。它可以是单个值或列表。"
    }
  ],
  "source": {
    "repo": "https://github.com/jaywcjlove/reference",
    "path": "docs/docker-compose.md",
    "ref": "main",
    "url": "https://github.com/jaywcjlove/reference/tree/main/docs/docker-compose.md",
    "lang": "zh",
    "mode": "local"
  }
}