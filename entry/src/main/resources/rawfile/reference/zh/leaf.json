{
  "id": "leaf",
  "name": "Leaf 备忘清单",
  "title": "[Leaf](https://github.com/vapor/leaf) 是 [Vapor](https://github.com/vapor/vapor) 的轻量级模板引擎，用于在服务端生成动态 HTML 页面。",
  "icon": "https://raw.githubusercontent.com/jaywcjlove/reference/main/assets/leaf.svg",
  "sections": [
    {
      "id": "intro",
      "title": "简介",
      "startIndex": 0
    },
    {
      "id": "s1",
      "title": "入门",
      "startIndex": 1
    },
    {
      "id": "s2",
      "title": "Leaf 概述",
      "startIndex": 20
    },
    {
      "id": "s3",
      "title": "自定义标签",
      "startIndex": 74
    }
  ],
  "cards": [
    {
      "id": "intro-0",
      "sectionId": "intro",
      "title": "简介",
      "kind": "text",
      "body": "[Leaf](https://github.com/vapor/leaf) 是 [Vapor](https://github.com/vapor/vapor) 的轻量级模板引擎，用于在服务端生成动态 HTML 页面。"
    },
    {
      "id": "s1-1",
      "sectionId": "s1",
      "title": "Leaf",
      "kind": "text",
      "body": "`Leaf` 是一种强大的模板语言，其语法受 `Swift` 启发。"
    },
    {
      "id": "s1-2",
      "sectionId": "s1",
      "title": "Leaf",
      "kind": "text",
      "body": "• [Leaf 模板语言官方文档](https://docs.vapor.codes/zh/leaf/getting-started/) _(vapor.codes)_\n• [**LeafKit**：Swift 模板引擎库](https://github.com/vapor/leaf-kit) _(github.com)_\n• [**Leaf**：LeafKit 的 Vapor 集成模板系统](https://github.com/vapor/leaf) _(github.com)_"
    },
    {
      "id": "s1-3",
      "sectionId": "s1",
      "title": "Package",
      "kind": "code",
      "lang": "swift",
      "code": "// swift-tools-version:5.2\nimport PackageDescription\n\nlet package = Package(\n    name: \"MyApp\",\n    platforms: [ .macOS(.v10_15) ],\n    dependencies: [ /// 添加其它依赖\n        .package(url: \"https://github.com/vapor/leaf.git\", from: \"4.0.0\"),\n    ],\n    targets: [\n        .target(name: \"App\", dependencies: [ .product(name: \"Leaf\", package: \"leaf\") ]),\n    ]\n)"
    },
    {
      "id": "s1-4",
      "sectionId": "s1",
      "title": "配置",
      "kind": "code",
      "lang": "swift",
      "code": "import Vapor\nimport Leaf"
    },
    {
      "id": "s1-5",
      "sectionId": "s1",
      "title": "配置",
      "kind": "text",
      "body": "设置工作目录"
    },
    {
      "id": "s1-6",
      "sectionId": "s1",
      "title": "配置",
      "kind": "code",
      "lang": "swift",
      "code": "app.directory.workingDirectory = \"....\""
    },
    {
      "id": "s1-7",
      "sectionId": "s1",
      "title": "配置",
      "kind": "text",
      "body": "设置模板目录"
    },
    {
      "id": "s1-8",
      "sectionId": "s1",
      "title": "配置",
      "kind": "code",
      "lang": "swift",
      "code": "app.directory.viewsDirectory = \"....\""
    },
    {
      "id": "s1-9",
      "sectionId": "s1",
      "title": "配置",
      "kind": "text",
      "body": "设置模板引擎"
    },
    {
      "id": "s1-10",
      "sectionId": "s1",
      "title": "配置",
      "kind": "code",
      "lang": "swift",
      "code": "app.views.use(.leaf)"
    },
    {
      "id": "s1-11",
      "sectionId": "s1",
      "title": "配置",
      "kind": "text",
      "body": "配置自定义标签"
    },
    {
      "id": "s1-12",
      "sectionId": "s1",
      "title": "配置",
      "kind": "code",
      "lang": "swift",
      "code": "app.leaf.tags[\"relative\"] = CustomTag()"
    },
    {
      "id": "s1-13",
      "sectionId": "s1",
      "title": "目录结构",
      "kind": "code",
      "lang": "",
      "code": "VaporApp\n├── Package.swift\n├── Resources\n│   ├── Views\n│   │   └── hello.leaf\n├── Public\n│   ├── images (images 资源)\n│   ├── styles (css 资源)\n└── Sources\n    └── ..."
    },
    {
      "id": "s1-14",
      "sectionId": "s1",
      "title": "目录结构",
      "kind": "text",
      "body": "• Views 文件夹来存储 `.leaf` 文件\n• 配置 [`FileMiddleware`](https://api.vapor.codes/vapor/documentation/vapor/filemiddleware/) 提供静态文件"
    },
    {
      "id": "s1-15",
      "sectionId": "s1",
      "title": "目录结构",
      "kind": "code",
      "lang": "swift",
      "code": "app.middleware.use(FileMiddleware(\n    publicDirectory: \n        app.directory.publicDirectory\n))"
    },
    {
      "id": "s1-16",
      "sectionId": "s1",
      "title": "渲染视图",
      "kind": "code",
      "lang": "swift",
      "code": "app.get(\"hello\") { \n    req -> EventLoopFuture<View> in\n    return req.view.render(\"hello\", [\n        \"name\": \"Leaf\"\n    ])\n}\n// 或\napp.get(\"hello\") { \n    req async throws -> View in\n    return try await req.view.render(\n        \"hello\", [\"name\": \"Leaf\"]\n    )\n}"
    },
    {
      "id": "s1-17",
      "sectionId": "s1",
      "title": "渲染视图",
      "kind": "text",
      "body": "在 `hello.leaf` 模板中使用 `name`"
    },
    {
      "id": "s1-18",
      "sectionId": "s1",
      "title": "渲染视图",
      "kind": "code",
      "lang": "",
      "code": "Hello, #(name)!"
    },
    {
      "id": "s1-19",
      "sectionId": "s1",
      "title": "渲染视图",
      "kind": "text",
      "body": "打开浏览器访问 `/hello` 显示 `Hello, Leaf!`。"
    },
    {
      "id": "s2-20",
      "sectionId": "s2",
      "title": "模板语法",
      "kind": "text",
      "body": "一个基本的 `Leaf` 标签使用示例"
    },
    {
      "id": "s2-21",
      "sectionId": "s2",
      "title": "模板语法",
      "kind": "code",
      "lang": "swift",
      "code": "There are #count(users) users."
    },
    {
      "id": "s2-22",
      "sectionId": "s2",
      "title": "模板语法",
      "kind": "text",
      "body": "可以使用冒号和结束标签为某些标签提供可选的正文。"
    },
    {
      "id": "s2-23",
      "sectionId": "s2",
      "title": "模板语法",
      "kind": "text",
      "body": "• 标记 `#`：这表示 leaf 解析器开始寻找的标记。\n• 名称 `count`：标签的标识符。\n• 参数列表 (`users`)：可以接受零个或多个参数。"
    },
    {
      "id": "s2-24",
      "sectionId": "s2",
      "title": "内置标签示例",
      "kind": "code",
      "lang": "html",
      "code": "#(variable)\n#extend(\"template\"): 添加到模板中！#endextend\n#export(\"title\"): 欢迎使用 Vapor #endexport\n#import(\"body\")\n#count(friends)\n#for(friend in friends): \n    <li>#(friend.name)</li> \n#endfor"
    },
    {
      "id": "s2-25",
      "sectionId": "s2",
      "title": "内置标签示例",
      "kind": "text",
      "body": "文件夹中的模板"
    },
    {
      "id": "s2-26",
      "sectionId": "s2",
      "title": "内置标签示例",
      "kind": "code",
      "lang": "html",
      "code": "#extend(\"partials/detail-layout\"):\n    #export(\"body\"): 详情页面 #endexport\n#endextend"
    },
    {
      "id": "s2-27",
      "sectionId": "s2",
      "title": "表达式",
      "kind": "text",
      "body": "• `+`\n• `%`\n• `>`\n• `==`\n• `||`"
    },
    {
      "id": "s2-28",
      "sectionId": "s2",
      "title": "表达式",
      "kind": "code",
      "lang": "leaf",
      "code": "#if(1 + 1 == 2):\n    Hello!\n#endif\n\n#if(index % 2 == 0):\n    This is even index.\n#else:\n    This is odd index.\n#endif"
    },
    {
      "id": "s2-29",
      "sectionId": "s2",
      "title": "上下文",
      "kind": "text",
      "body": "Leaf 推荐用 `Encodable` 结构体传数据，数组需包装，`[String: Any]` 不支持。"
    },
    {
      "id": "s2-30",
      "sectionId": "s2",
      "title": "上下文",
      "kind": "code",
      "lang": "swift",
      "code": "struct WelcomeContext: Encodable {\n    var title: String\n    var numbers: [Int]\n}\nreturn req.view.render(\"home\", \n    WelcomeContext(\n        title: \"Hello!\", \n        numbers: [42, 9001]\n    )\n)"
    },
    {
      "id": "s2-31",
      "sectionId": "s2",
      "title": "上下文",
      "kind": "text",
      "body": "`title` 和 `numbers` 将暴露给 `Leaf` 模板，就可以在标签中使用这些变量。"
    },
    {
      "id": "s2-32",
      "sectionId": "s2",
      "title": "上下文",
      "kind": "code",
      "lang": "html",
      "code": "<h1>#(title)</h1>\n#for(number in numbers):\n    <p>#(number)</p>\n#endfor"
    },
    {
      "id": "s2-33",
      "sectionId": "s2",
      "title": "条件",
      "kind": "text",
      "body": "变量是否存在"
    },
    {
      "id": "s2-34",
      "sectionId": "s2",
      "title": "条件",
      "kind": "code",
      "lang": "html",
      "code": "#if(title):\n    The title is #(title)\n#endif"
    },
    {
      "id": "s2-35",
      "sectionId": "s2",
      "title": "条件",
      "kind": "text",
      "body": "比较"
    },
    {
      "id": "s2-36",
      "sectionId": "s2",
      "title": "条件",
      "kind": "code",
      "lang": "html",
      "code": "#if(title == \"Welcome\"):\n    This is a friendly web page.\n#endif"
    },
    {
      "id": "s2-37",
      "sectionId": "s2",
      "title": "条件",
      "kind": "text",
      "body": "使用另一个标签作为判断条件的一部分，内部标签应该省略 `#`"
    },
    {
      "id": "s2-38",
      "sectionId": "s2",
      "title": "条件",
      "kind": "code",
      "lang": "html",
      "code": "#if(count(users) > 0):\n    You have users!\n#else:\n    There are no users yet :(\n#endif"
    },
    {
      "id": "s2-39",
      "sectionId": "s2",
      "title": "条件",
      "kind": "text",
      "body": "多个条件满足时才渲染内容的模板"
    },
    {
      "id": "s2-40",
      "sectionId": "s2",
      "title": "条件",
      "kind": "code",
      "lang": "html",
      "code": "#if(title == \"user\" && count(users) > 0):\n    You have users!\n#endif"
    },
    {
      "id": "s2-41",
      "sectionId": "s2",
      "title": "#elseif",
      "kind": "code",
      "lang": "html",
      "code": "#if(title == \"Welcome\"):\n    Hello new user!\n#elseif(title == \"Welcome back!\"):\n    Hello old user\n#else:\n    Unexpected page!\n#endif"
    },
    {
      "id": "s2-42",
      "sectionId": "s2",
      "title": "循环",
      "kind": "code",
      "lang": "swift",
      "code": "struct SolarSystem: Codable {\n  let planets = [\"Venus\", \"Earth\", \"Mars\"]\n}\nreturn req.view.render(\n  \"solarSystem\", SolarSystem()\n)"
    },
    {
      "id": "s2-43",
      "sectionId": "s2",
      "title": "循环",
      "kind": "text",
      "body": "在 `Leaf` 中循环它们："
    },
    {
      "id": "s2-44",
      "sectionId": "s2",
      "title": "循环",
      "kind": "code",
      "lang": "html",
      "code": "<ul>\n#for(planet in planets):\n    <li>#(planet)</li>\n#endfor\n</ul>"
    },
    {
      "id": "s2-45",
      "sectionId": "s2",
      "title": "模板示例",
      "kind": "text",
      "body": "入口页面，通过 `#extend(\"main\")` 将 `mainleaf` 模板的内容复制到当前模板中使用"
    },
    {
      "id": "s2-46",
      "sectionId": "s2",
      "title": "模板示例",
      "kind": "code",
      "lang": "html",
      "code": "#extend(\"main\"):\n  #export(\"body\"):\n    <p>Welcome to Vapor!</p>\n  #endexport\n#endextend"
    },
    {
      "id": "s2-47",
      "sectionId": "s2",
      "title": "模板示例",
      "kind": "text",
      "body": "在公共模板 `main.leaf` 中"
    },
    {
      "id": "s2-48",
      "sectionId": "s2",
      "title": "模板示例",
      "kind": "code",
      "lang": "html",
      "code": "<html>\n  <head>\n    <title>#(name)</title>\n  </head>\n  <body>#import(\"body\")</body>\n</html>"
    },
    {
      "id": "s2-49",
      "sectionId": "s2",
      "title": "模板示例",
      "kind": "text",
      "body": "呈现如下内容："
    },
    {
      "id": "s2-50",
      "sectionId": "s2",
      "title": "模板示例",
      "kind": "code",
      "lang": "html",
      "code": "<html>\n  <head>\n    <title>Leaf</title>\n  </head>\n  <body>\n    <p>Welcome to Vapor!</p>\n  </body>\n</html>"
    },
    {
      "id": "s2-51",
      "sectionId": "s2",
      "title": "扩展模板",
      "kind": "text",
      "body": "在模板中使用 `#export` 存储名为 `body` 的一些 HTML"
    },
    {
      "id": "s2-52",
      "sectionId": "s2",
      "title": "扩展模板",
      "kind": "code",
      "lang": "html",
      "code": "#export(\"body\"):\n    <p>Welcome to Vapor!</p>\n#endexport"
    },
    {
      "id": "s2-53",
      "sectionId": "s2",
      "title": "扩展模板",
      "kind": "text",
      "body": "使用 `#import` 获取传递给 `#extend` 标签的内容"
    },
    {
      "id": "s2-54",
      "sectionId": "s2",
      "title": "扩展模板",
      "kind": "code",
      "lang": "html",
      "code": "<body>\n  #import(\"body\")\n</body>"
    },
    {
      "id": "s2-55",
      "sectionId": "s2",
      "title": "#count",
      "kind": "code",
      "lang": "html",
      "code": "Your search matched #count(matches) pages."
    },
    {
      "id": "s2-56",
      "sectionId": "s2",
      "title": "#count",
      "kind": "text",
      "body": "`#count` 标签返回数组中的项目数量"
    },
    {
      "id": "s2-57",
      "sectionId": "s2",
      "title": "#lowercased",
      "kind": "code",
      "lang": "html",
      "code": "#lowercased(name)"
    },
    {
      "id": "s2-58",
      "sectionId": "s2",
      "title": "#lowercased",
      "kind": "text",
      "body": "`#lowercased` 标签将字符串转成小写字母。"
    },
    {
      "id": "s2-59",
      "sectionId": "s2",
      "title": "#capitalized",
      "kind": "code",
      "lang": "html",
      "code": "#capitalized(name)"
    },
    {
      "id": "s2-60",
      "sectionId": "s2",
      "title": "#capitalized",
      "kind": "text",
      "body": "`#capitalized` 标签将字符串中每个单词的首字母大写，其他字母小写。"
    },
    {
      "id": "s2-61",
      "sectionId": "s2",
      "title": "#contains",
      "kind": "code",
      "lang": "html",
      "code": "#if(contains(planets, \"Earth\")):\n    Earth is here!\n#else:\n    Earth is not in this array.\n#endif"
    },
    {
      "id": "s2-62",
      "sectionId": "s2",
      "title": "#contains",
      "kind": "text",
      "body": "`#contains` 标签接受一个数组和一个值作为其两个参数，如果参数一中的数组包含参数二中的值，则返回 true。"
    },
    {
      "id": "s2-63",
      "sectionId": "s2",
      "title": "#date",
      "kind": "text",
      "body": "`#date` 标签将日期格式化为可读的字符串。默认情况下，它使用 ISO8601 格式。"
    },
    {
      "id": "s2-64",
      "sectionId": "s2",
      "title": "#date",
      "kind": "code",
      "lang": "swift",
      "code": "render(..., [\"now\": Date()])"
    },
    {
      "id": "s2-65",
      "sectionId": "s2",
      "title": "#date",
      "kind": "text",
      "body": "模板中使用"
    },
    {
      "id": "s2-66",
      "sectionId": "s2",
      "title": "#date",
      "kind": "code",
      "lang": "",
      "code": "The time is #date(now)"
    },
    {
      "id": "s2-67",
      "sectionId": "s2",
      "title": "#date",
      "kind": "text",
      "body": "你可以传自定义日期格式作为第二参数，详见 [Swift DateFormatter](https://developer.apple.com/documentation/foundation/dateformatter)。"
    },
    {
      "id": "s2-68",
      "sectionId": "s2",
      "title": "#date",
      "kind": "code",
      "lang": "",
      "code": "The date is #date(now, \"yyyy-MM-dd\")"
    },
    {
      "id": "s2-69",
      "sectionId": "s2",
      "title": "#unsafeHTML",
      "kind": "text",
      "body": "标签就像一个变量标签 - 例如 `#(variable)`。"
    },
    {
      "id": "s2-70",
      "sectionId": "s2",
      "title": "#unsafeHTML",
      "kind": "code",
      "lang": "",
      "code": "The time is #unsafeHTML(styledTitle)"
    },
    {
      "id": "s2-71",
      "sectionId": "s2",
      "title": "#unsafeHTML",
      "kind": "text",
      "body": "它不会转义任何 `variable` 可能包含的 HTML 标签"
    },
    {
      "id": "s2-72",
      "sectionId": "s2",
      "title": "#dumpContext",
      "kind": "text",
      "body": "`#dumpContext` 标签将整个上下文渲染为可读的字符串。使用此标记来调试作为上下文提供给当前渲染的内容。"
    },
    {
      "id": "s2-73",
      "sectionId": "s2",
      "title": "#dumpContext",
      "kind": "code",
      "lang": "",
      "code": "Hello, world!\n#dumpContext"
    },
    {
      "id": "s3-74",
      "sectionId": "s3",
      "title": "LeafTag",
      "kind": "text",
      "body": "创建一个名为 `NowTag` 的类并遵循 `LeafTag` 协议"
    },
    {
      "id": "s3-75",
      "sectionId": "s3",
      "title": "LeafTag",
      "kind": "code",
      "lang": "swift",
      "code": "struct NowTag: LeafTag {\n    func render(_ ctx: LeafContext) throws -> LeafData {\n        ...\n    }\n}"
    },
    {
      "id": "s3-76",
      "sectionId": "s3",
      "title": "LeafTag",
      "kind": "text",
      "body": "实现 `render(_:)` 方法。传递给该方法的 `LeafContext` 参数包含了我们需要的所有内容。"
    },
    {
      "id": "s3-77",
      "sectionId": "s3",
      "title": "LeafTag",
      "kind": "code",
      "lang": "swift",
      "code": "enum NowTagError: Error {\n    case invalidFormatParameter\n    case tooManyParameters\n}\n\nstruct NowTag: LeafTag {\n    func render(_ ctx: LeafContext) throws -> LeafData {\n        let formatter = DateFormatter()\n        switch ctx.parameters.count {\n        case 0: formatter.dateFormat = \"yyyy-MM-dd HH:mm:ss\"\n        case 1:\n            guard let string = ctx.parameters[0].string else {\n                throw NowTagError.invalidFormatParameter\n            }\n\n            formatter.dateFormat = string\n        default:\n            throw NowTagError.tooManyParameters\n        }\n\n        let dateAsString = formatter.string(from: Date())\n        return LeafData.string(dateAsString)\n    }\n}"
    },
    {
      "id": "s3-78",
      "sectionId": "s3",
      "title": "配置标签",
      "kind": "text",
      "body": "实现了 `NowTag`，告诉 `Leaf` 并设置标签名称为 `#now`"
    },
    {
      "id": "s3-79",
      "sectionId": "s3",
      "title": "配置标签",
      "kind": "code",
      "lang": "swift",
      "code": "app.leaf.tags[\"now\"] = NowTag()"
    },
    {
      "id": "s3-80",
      "sectionId": "s3",
      "title": "配置标签",
      "kind": "text",
      "body": "现在可以在 Leaf 中使用我们的自定义标签 `#now` 了"
    },
    {
      "id": "s3-81",
      "sectionId": "s3",
      "title": "配置标签",
      "kind": "code",
      "lang": "html",
      "code": "The time is #now()"
    },
    {
      "id": "s3-82",
      "sectionId": "s3",
      "title": "上下文属性",
      "kind": "text",
      "body": "#### `parameters`： 包含标签参数的数组"
    },
    {
      "id": "s3-83",
      "sectionId": "s3",
      "title": "上下文属性",
      "kind": "code",
      "lang": "swift",
      "code": "struct NowTag: LeafTag {\n  func render(\n    _ ctx: LeafContext\n  ) throws -> LeafData {\n      /// ctx.parameters\n  }\n}"
    },
    {
      "id": "s3-84",
      "sectionId": "s3",
      "title": "上下文属性",
      "kind": "text",
      "body": "#### 使用 Data，`render(_:_:)` 方法作为上下文视图的数据"
    },
    {
      "id": "s3-85",
      "sectionId": "s3",
      "title": "上下文属性",
      "kind": "code",
      "lang": "swift",
      "code": "return try await req.view.render(\n  \"home\", [\"name\": \"John\"]\n)"
    },
    {
      "id": "s3-86",
      "sectionId": "s3",
      "title": "上下文属性",
      "kind": "text",
      "body": "自定义标签使用 `Data`"
    },
    {
      "id": "s3-87",
      "sectionId": "s3",
      "title": "上下文属性",
      "kind": "code",
      "lang": "swift",
      "code": "struct NowTag: LeafTag {\n  func render(\n    _ ctx: LeafContext\n  ) throws -> LeafData {\n      let name = ctx.data[\"name\"]?.string\n  }\n}"
    },
    {
      "id": "s3-88",
      "sectionId": "s3",
      "title": "上下文属性",
      "kind": "text",
      "body": "`LeafContext` 包含两个重要的属性"
    },
    {
      "id": "s3-89",
      "sectionId": "s3",
      "title": "相对路径拼接标签",
      "kind": "code",
      "lang": "swift",
      "code": "struct RelativePathTag: LeafTag {\n    func render(_ ctx: LeafContext) throws -> LeafData {\n        guard ctx.parameters.count == 1, let filename = ctx.parameters[0].string else {\n            throw \"Missing #relative parameters\"\n        }\n        if let filepath = ctx.request?.url.path, filename.hasPrefix(\"/\") == false {\n            return .string(\"\\(relativePrefix(for: filepath, targetFile: filename))\")\n        }\n        return .string(\"\\(filename)\")\n    }\n    private func relativePrefix(for pagePath: String, targetFile: String) -> String {\n        var components = pagePath\n            .trimmingCharacters(in: CharacterSet(charactersIn: \"/\"))\n            .split(separator: \"/\")\n        if let last = components.last, last.contains(\".\") {\n            components = components.dropLast()\n        }\n        let cleanTarget = targetFile.hasPrefix(\"./\") \n            ? String(targetFile.dropFirst(2)) \n            : targetFile\n        return String(repeating: \"../\", count: components.count) + cleanTarget\n    }\n}"
    },
    {
      "id": "s3-90",
      "sectionId": "s3",
      "title": "相对路径拼接标签",
      "kind": "text",
      "body": "配置标签"
    },
    {
      "id": "s3-91",
      "sectionId": "s3",
      "title": "相对路径拼接标签",
      "kind": "code",
      "lang": "swift",
      "code": "app.leaf.tags[\"relative\"] = RelativePathTag()"
    },
    {
      "id": "s3-92",
      "sectionId": "s3",
      "title": "相对路径拼接标签",
      "kind": "text",
      "body": "现在可以在 Leaf 中使用我们的自定义标签了"
    },
    {
      "id": "s3-93",
      "sectionId": "s3",
      "title": "相对路径拼接标签",
      "kind": "code",
      "lang": "html",
      "code": "<link rel=\"stylesheet\" href=\"#relative(\"main.css\")\" />"
    }
  ],
  "source": {
    "repo": "https://github.com/jaywcjlove/reference",
    "path": "docs/leaf.md",
    "ref": "main",
    "url": "https://github.com/jaywcjlove/reference/tree/main/docs/leaf.md",
    "lang": "zh",
    "mode": "local"
  }
}