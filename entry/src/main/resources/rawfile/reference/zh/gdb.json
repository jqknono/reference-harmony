{
  "id": "gdb",
  "name": "GDB 备忘清单",
  "title": "本清单提供了对 [GDB](https://en.wikipedia.org/wiki/GNU_Debugger) 的入门简要概述，以及 `GDB` 常用示例，完整文档参阅 [Debugging with gdb](https://www.eecs.umich.edu/courses/eecs373/readings/Debugger.pdf)，该文档最后有 `GDB index`，可以快速查找命令。",
  "icon": "https://raw.githubusercontent.com/jaywcjlove/reference/main/assets/gdb.svg",
  "sections": [
    {
      "id": "intro",
      "title": "简介",
      "startIndex": 0
    },
    {
      "id": "s1",
      "title": "入门",
      "startIndex": 1
    },
    {
      "id": "s2",
      "title": "另见",
      "startIndex": 36
    }
  ],
  "cards": [
    {
      "id": "intro-0",
      "sectionId": "intro",
      "title": "简介",
      "kind": "text",
      "body": "本清单提供了对 [GDB](https://en.wikipedia.org/wiki/GNU_Debugger) 的入门简要概述，以及 `GDB` 常用示例，完整文档参阅 [Debugging with gdb](https://www.eecs.umich.edu/courses/eecs373/readings/Debugger.pdf)，该文档最后有 `GDB index`，可以快速查找命令。"
    },
    {
      "id": "s1-1",
      "sectionId": "s1",
      "title": "常用命令",
      "kind": "text",
      "body": "`[]` 内为命令缩写"
    },
    {
      "id": "s1-2",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "| 命令 `[缩写]`               | 说明       |\n|:--------------------|:-----------|\n| `help[h]` | **查看命令帮助**。如 `help run` |\n| `run[r]` | **运行程序**。可搭配参数使用 |\n| `start` | **运行程序，停在第一条执行语句**。可搭配参数使用 |\n| `list[l]` | **查看程序源码** |\n| `break[b]` | **设置断点**。可指定文件名、函数名和行号等参数来设置断点 |\n| `watch` | **设置监视点**。当监视的变量发生更改时，程序会被中断 |\n| `delete` | **删除断点等**。可用于删除断点、监视点、`display` 等 |\n| `continue[c]` | **继续执行程序**。让程序继续执行，到下一个断点或程序结束 |\n| `next[n]` | **单步执行程序，跳过函数调用** |\n| `step[s]` | **单步执行程序，进入函数调用** |\n| `finish` | **结束当前函数**。返回到函数调用点 |\n| `kill` | **杀死当前的调试进程** |\n| `backtrace[bt]` | **查看函数调用栈**。它会打印出当前的函数调用栈 |\n| `frame[fr]` | **切换栈帧**。以查看该栈帧中的局部变量和参数等 |\n| `info` | **查看程序状态信息**。例如断点、寄存器、线程、局部变量等 |\n| `show` | **查看 `gdb` 配置信息**。与 `info` 不同， `show` 查看 `GDB` 本身的配置信息 |\n| `set` | **设置变量值**。有时指定变量类型才能设置，如 `set *(int*)(&a) = 3` |\n| `whatis` | **查看变量、函数类型**。例如，`whatis a` 可以显示变量 `a` 的类型 |\n| `ptype` | **查看变量、函数类型**。会显示完整的结构体类型 |\n| `print[p]` | **打印变量的值**。例如，`print x` 可以显示变量 `x` 的当前值 |\n| `display` | **持续打印变量的值**。与 `print` 类似，但它会在每次停下时自动输出值 |\n| `thread` | **切换线程**。例如，`thread 2` 切换到编号为 `2` 的线程 |\n| `signal` | **向进程发送信号**。例如，`signal 9` 发送编号为 `9` 的信号 |"
    },
    {
      "id": "s1-3",
      "sectionId": "s1",
      "title": "启动调试",
      "kind": "text",
      "body": "启动进程，不带参数"
    },
    {
      "id": "s1-4",
      "sectionId": "s1",
      "title": "",
      "kind": "code",
      "lang": "bash",
      "code": "# gdb <program>\n(gdb) run"
    },
    {
      "id": "s1-5",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "启动进程，带参数 `<args>`"
    },
    {
      "id": "s1-6",
      "sectionId": "s1",
      "title": "",
      "kind": "code",
      "lang": "bash",
      "code": "# gdb <program>\n(gdb) run <args>"
    },
    {
      "id": "s1-7",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "启动 `gdb` 时传入参数，`run` 就不用传入了"
    },
    {
      "id": "s1-8",
      "sectionId": "s1",
      "title": "",
      "kind": "code",
      "lang": "bash",
      "code": "# gdb --args <program> 1 2 3\n(gdb) run"
    },
    {
      "id": "s1-9",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "通过 `set` 设置参数"
    },
    {
      "id": "s1-10",
      "sectionId": "s1",
      "title": "",
      "kind": "code",
      "lang": "bash",
      "code": "# gdb <program>\n(gdb) set args 1 2 3\n(gdb) run"
    },
    {
      "id": "s1-11",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "显示运行时将要或已经传递给程序的参数"
    },
    {
      "id": "s1-12",
      "sectionId": "s1",
      "title": "",
      "kind": "code",
      "lang": "bash",
      "code": "(gdb) show args"
    },
    {
      "id": "s1-13",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "在启动进程前，添加环境变量"
    },
    {
      "id": "s1-14",
      "sectionId": "s1",
      "title": "",
      "kind": "code",
      "lang": "bash",
      "code": "(gdb) set env DEBUG 1"
    },
    {
      "id": "s1-15",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "在启动进程前，清除环境变量"
    },
    {
      "id": "s1-16",
      "sectionId": "s1",
      "title": "",
      "kind": "code",
      "lang": "bash",
      "code": "(gdb) unset env DEBUG"
    },
    {
      "id": "s1-17",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "通过进程号 `123` 连接到正在运行的进程"
    },
    {
      "id": "s1-18",
      "sectionId": "s1",
      "title": "",
      "kind": "code",
      "lang": "bash",
      "code": "(gdb) attach 123"
    },
    {
      "id": "s1-19",
      "sectionId": "s1",
      "title": "core dump 文件",
      "kind": "text",
      "body": "默认情况下，`linux` 系统中程序崩溃时也不会生成 `core dump` 文件，需要先启用"
    },
    {
      "id": "s1-20",
      "sectionId": "s1",
      "title": "",
      "kind": "code",
      "lang": "bash",
      "code": "ulimit%20-c%20unlimited%0Aecho%20%22%2Ftmp%2Fcore-%25e-%25p-%25t%22%20%3E%20%2Fproc%2Fsys%2Fkernel%2Fcore_pattern",
      "encoded": true
    },
    {
      "id": "s1-21",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "调试 `core` 文件"
    },
    {
      "id": "s1-22",
      "sectionId": "s1",
      "title": "",
      "kind": "code",
      "lang": "bash",
      "code": "gdb program /tmp/core-file"
    },
    {
      "id": "s1-23",
      "sectionId": "s1",
      "title": "查看源码",
      "kind": "text",
      "body": "| 命令                | 说明       |\n|:--------------------|:-----------|\n| `(gdb) list 30` | 查看第 `30` 行为中心的上下 `5` 行源码 |\n| `(gdb) list main` | 查看 `main` 函数为中心的上下 `5` 行源码 |\n| `(gdb) list file.c:30` | 查看 `file.c` 文件中 `30` 行的源码 |\n| `(gdb) list file.c:main` | 查看 `file.c` 文件中 `main` 函数 |\n| `(gdb) disassemble` | 查看当前可执行文件的汇编源码 |\n| `(gdb) disassemble myfun` | 查看指定函数的汇编源码 |"
    },
    {
      "id": "s1-24",
      "sectionId": "s1",
      "title": "流程控制",
      "kind": "text",
      "body": "| 命令                | 说明       |\n|:--------------------|:-----------|\n| `(gdb) step[s]` | 执行源码级别的单步进入操作 |\n| `(gdb) stepi[si]` | 执行指令级别的单步进入操作 |\n| `(gdb) next[n]` | 执行源码级别的单步跳过操作 |\n| `(gdb) nexti[ni]` | 执行指令级别的单步跳过操作 |\n| `(gdb) continue[c]` | 继续执行，到下一个断点或程序结束 |\n| `(gdb) finish` | 运行完当前函数，并返回到函数调用点 |\n| `(gdb) return` | 直接退出当前函数，不执行剩下代码块 |\n| `(gdb) return expression` | 可以指定返回值的内容 |\n| `(gdb) until` | 结束当前循环 |"
    },
    {
      "id": "s1-25",
      "sectionId": "s1",
      "title": "断点命令",
      "kind": "text",
      "body": "| 命令                | 说明       |\n|:--------------------|:-----------|\n| `(gdb) break main` | 在所有名为 `main` 的函数处设置一个断点 |\n| `(gdb) break test.c:12` | 在文件 `test.c` 的第 `12` 行设置断点 |\n| `(gdb) break test.c:func` | 在文件 `test.c` 的 `func` 函数处设置断点 |\n| `(gdb) rbreak regular-expression` | 在正则表达式匹配的函数名上设置断点 |\n| `(gdb) break foo if a < 100` | 设置**条件断点**，条件满足才停止 |\n| `(gdb) info break` | 列出所有断点位置、编号 |\n| `(gdb) delete 2` | 删除指定编号的断点 |\n| `(gdb) clear` | 删除刚才停止处的断点 |\n| `(gdb) disable 1` | `disable` 指定编号的断点 |\n| `(gdb) enable 1` | `enable` 指定编号的断点 |"
    },
    {
      "id": "s1-26",
      "sectionId": "s1",
      "title": "watch 命令",
      "kind": "text",
      "body": "| 命令                | 说明       |\n|:--------------------|:-----------|\n| `(gdb) watch var` | 监视变量，当值变化时会输出新、旧值 |\n| `(gdb) info break` | 列出断点，也包括 `watchpoint` |\n| `(gdb) i watch` | 只列出 `watchpoint` |\n| `(gdb) delete 1` | 删除指定的 `watchpoint` |"
    },
    {
      "id": "s1-27",
      "sectionId": "s1",
      "title": "查看变量",
      "kind": "text",
      "body": "| 命令                | 说明       |\n|:--------------------|:-----------|\n| `(gdb) info args` | 查看传入参数信息 |\n| `(gdb) info local` | 查看当前栈帧（函数）的本地变量 |\n| `(gdb) print var` | 查看指定变量的值 |\n| `(gdb) print/x var` | 以十六进制输出变量的值 |\n| `(gdb) print ptr` | 假设 `int *ptr=&a`，输出变量 `a` 的地址 |\n| `(gdb) print *ptr` | 假设 `int *ptr=&a`，输出变量 `a` 的值 |\n| `(gdb) print *ptr@5` | 假设 `int ptr[5]`，输出数组的值 |\n| `(gdb) display var` | 与 `print` 作用相同，但每次停下来都自动输出变量的值 |\n| `(gdb) info display` | 列出所有设置了 `display` 的变量 |\n| `(gdb) undisplay 1` | 与 `display` 相反，不能指定变量名，只能是编号 |\n| `(gdb) delete display 1` | 与 `undisplay` 类似，通过编号取消显示 |\n| `(gdb) whatis var` | 查看变量类型 |\n| `(gdb) ptype var` | 比 `type` 更详细，会给出结构体的定义 |"
    },
    {
      "id": "s1-28",
      "sectionId": "s1",
      "title": "frame 栈帧",
      "kind": "text",
      "body": "每当一个函数被调用时，一个新的栈帧 `frame` 就会被压入栈中，栈帧包含了该函数的局部变量、参数、返回地址和其他信息，当函数执行完毕后，这个栈帧会被弹出栈并销毁。"
    },
    {
      "id": "s1-29",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "| 命令                | 说明       |\n|:--------------------|:-----------|\n| `(gdb) frame` | 显示当前栈帧和源代码行 |\n| `(gdb) backtrace` | 打印出当前正在执行的所有栈帧 |\n| `(gdb) backtrace 5` | 只显示最近调用的 `5` 个栈帧 |\n| `(gdb) frame 2` | 切换到第 `2` 个栈帧，以查看信息 |\n| `(gdb) up` | 切换到上一级调用栈帧 |\n| `(gdb) down` | 切换到下一级调用栈帧 |"
    },
    {
      "id": "s1-30",
      "sectionId": "s1",
      "title": "函数调用",
      "kind": "text",
      "body": "`call` 和 `print` 调用的函数如果存在全局变量、静态变量的修改，在函数返回后会恢复到调用之前的值，这两个调用不会影响程序的状态"
    },
    {
      "id": "s1-31",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "| 命令                | 说明       |\n|:--------------------|:-----------|\n| `(gdb) call func(a, b)` | 调用指定的函数，不影响主线程变量 |\n| `(gdb) print func(a, b)` | 与 `call` 类似 |\n| `(gdb) finish` | 结束当前运行的函数 |"
    },
    {
      "id": "s1-32",
      "sectionId": "s1",
      "title": "信号",
      "kind": "text",
      "body": "`linux` 下使用 `kill -l` 查看信号编号与信号名，使用 `info signal` 查看信号的处理方式、描述等："
    },
    {
      "id": "s1-33",
      "sectionId": "s1",
      "title": "",
      "kind": "code",
      "lang": "bash",
      "code": "(gdb) info signal\nSignal        Stop  Print   Pass to program Description\n\nSIGHUP        Yes   Yes     Yes             Hangup\nSIGINT        Yes   Yes     No              Interrupt\nSIGQUIT       Yes   Yes     Yes             Quit\nSIGILL        Yes   Yes     Yes             Illegal instruction"
    },
    {
      "id": "s1-34",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "| 命令                | 说明       |\n|:--------------------|:-----------|\n| `(gdb) signal SIGKILL` | 向进程发送信号，用信号名或编号表示 |\n| `(gdb) signal 9` | 向进程发送信号，用信号名或编号表示 |\n| `(gdb) handle <signal> actions` | 指定信号的处理方式，选择如下，可以组合 |\n| `stop/nostop` | 收到信号是否停止进程，类似断点 |\n| `print/noprint` | 收到信号是否输出消息 |\n| `pass/nopass` | 是否将信号传递给程序 |"
    },
    {
      "id": "s1-35",
      "sectionId": "s1",
      "title": "线程",
      "kind": "text",
      "body": "| 命令                | 说明       |\n|:--------------------|:-----------|\n| `(gdb) info threads` | 列出所有线程，标识当前所在线程 |\n| `(gdb) thread 2` | 切换到编号为 `2` 的线程 |\n| `(gdb) break file.c:23 thread all` | 在所有线程中相应的行上设置断点 |\n| `(gdb) thread apply all command` | 让所有线程执行 `gdb` 命令 |\n| `(gdb) thread apply ID1 ID2 command` | 让指定线程执行 `gdb` 命令 |\n| `(gdb) set scheduler-locking off` | 所有线程都执行，这是默认值 |\n| `(gdb) set scheduler-locking on` | 只让当前线程执行 |"
    },
    {
      "id": "s2-36",
      "sectionId": "s2",
      "title": "另见",
      "kind": "text",
      "body": "• [应用崩溃调试分析](https://carlyleliu.github.io/2022/%E5%BA%94%E7%94%A8%E5%B4%A9%E6%BA%83%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90)"
    }
  ],
  "source": {
    "repo": "https://github.com/jaywcjlove/reference",
    "path": "docs/gdb.md",
    "ref": "main",
    "url": "https://github.com/jaywcjlove/reference/tree/main/docs/gdb.md",
    "lang": "zh",
    "mode": "local"
  }
}