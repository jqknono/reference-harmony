{
  "id": "mitmproxy",
  "name": "Mitmproxy 备忘清单",
  "title": "[Mitmproxy](https://mitmproxy.org/) 是一个免费开源的交互式 HTTPS 代理。这是 mitmproxy 的快速参考备忘单。",
  "icon": "https://raw.githubusercontent.com/jaywcjlove/reference/main/assets/mitmproxy.svg",
  "sections": [
    {
      "id": "intro",
      "title": "简介",
      "startIndex": 0
    },
    {
      "id": "s1",
      "title": "入门",
      "startIndex": 1
    },
    {
      "id": "s2",
      "title": "Mitmproxy 过滤器",
      "startIndex": 21
    },
    {
      "id": "s3",
      "title": "Mitmproxy 脚本",
      "startIndex": 37
    },
    {
      "id": "s4",
      "title": "另见",
      "startIndex": 41
    }
  ],
  "cards": [
    {
      "id": "intro-0",
      "sectionId": "intro",
      "title": "简介",
      "kind": "text",
      "body": "[Mitmproxy](https://mitmproxy.org/) 是一个免费开源的交互式 HTTPS 代理。这是 mitmproxy 的快速参考备忘单。"
    },
    {
      "id": "s1-1",
      "sectionId": "s1",
      "title": "使用",
      "kind": "text",
      "body": "选项 | 范例 | 描述\n:--|--|--\n`-p`   | mitmproxy -p 8001                                  | 在端口 `8001` 上启动代理\n`-m`   | mitmproxy -p 8001 -m reverse:<http://127.0.0.1:4000> | `8001` 端口反向代理到4000端口\n`-w`   | mitmproxy -p 8001 -w traffic.mitm                  | 流到达时流向文件\n`-r`   | mitmproxy -r traffic.mitm                          | 从文件中读取流\n`-C`   | mitmproxy -C traffic.mitm                          | 从保存的文件重放客户端请求\n`-S`   | mitmproxy -S traffic.mitm                          | 从保存的文件重放服务器响应\n`-s`   | mitmproxy -s myScript.py                           | 执行脚本\n`-h`   | mitmproxy -h                                       | `mitmproxy` 快速帮助"
    },
    {
      "id": "s1-2",
      "sectionId": "s1",
      "title": "移动",
      "kind": "code",
      "lang": "markdown",
      "code": "        k                 Ctrl b\n        ▲                   ▲▲\n        │                   ││\nh ◀ ─── + ─── ▶ l           ││ page\n        │                   ││\n        ▼                   ▼▼\n        j             Ctrl f / Space"
    },
    {
      "id": "s1-3",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": ":---|---\n:---|---\n`h`, `j`, `k` ,`l`   | 左、下、上、右\n`Ctrl` `b`           | 向上翻页\n`Space` / `Ctrl` `f` | 向下翻页\n`g` / `G`            | 转到开头/结尾\n`Arrows`             | 上下左右"
    },
    {
      "id": "s1-4",
      "sectionId": "s1",
      "title": "安装",
      "kind": "text",
      "body": "• [mitmproxy 文档](https://docs.mitmproxy.org/stable/) _(mitmproxy.org)_\n• [mitmproxy 开源仓库](https://github.com/mitmproxy/mitmproxy) _(github.com)_"
    },
    {
      "id": "s1-5",
      "sectionId": "s1",
      "title": "",
      "kind": "code",
      "lang": "bash",
      "code": "$ brew install mitmproxy # macOS"
    },
    {
      "id": "s1-6",
      "sectionId": "s1",
      "title": "代理模式",
      "kind": "text",
      "body": "Argument | Effect\n:-- | --\n`-R REVERSE_PROXY`, `--reverse REVERSE_PROXY` | 将所有请求转发到上游 HTTP 服务器：`http[s]://host[:port]`。客户端始终可以通过 `HTTPS` 和 `HTTP` 进行连接，与服务器的连接由指定的方案决定\n`--socks` | 设置 `SOCKS5` 代理模式\n`-T`, `--transparent` | 设置透明代理模式\n`-U UPSTREAM_PROXY`, `--upstream UPSTREAM_PROXY` | 将所有请求转发到上游代理服务器：`http://host[:port]`\n<!--rehype:className=style-list-->"
    },
    {
      "id": "s1-7",
      "sectionId": "s1",
      "title": "复制到剪贴板",
      "kind": "text",
      "body": "命令语法："
    },
    {
      "id": "s1-8",
      "sectionId": "s1",
      "title": "",
      "kind": "code",
      "lang": "",
      "code": ":export.clip format flow"
    },
    {
      "id": "s1-9",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "例子："
    },
    {
      "id": "s1-10",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "| 描述 | 命令示例 |\n| ---|--- |\n| 1. 复制为 curl 命令 | `:export.clip curl @focus` |\n| 2. 复制为 httpie | `:export.clip httpie @focus` |\n| 3. 复制为原始文件 | `:export.clip raw @focus` |\n| 4. 复制为原始 HTTP 请求 | `:export.clip raw_request @focus` |\n| 5. 复制为原始 HTTP 响应 | `:export.clip raw_response @focus` |"
    },
    {
      "id": "s1-11",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "将流程导出到系统剪贴板"
    },
    {
      "id": "s1-12",
      "sectionId": "s1",
      "title": "保存到文件",
      "kind": "text",
      "body": "命令语法："
    },
    {
      "id": "s1-13",
      "sectionId": "s1",
      "title": "",
      "kind": "code",
      "lang": "",
      "code": ":export.file format flow path"
    },
    {
      "id": "s1-14",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "例子："
    },
    {
      "id": "s1-15",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "| 描述 | 命令示例 |\n| ---|--- |\n| 1. 导出到 `/tmp/a.curl` | `:export.file curl @focus /tmp/a.curl` |\n| 2. 导出到 `/tmp/a.httpie` | `:export.file httpie @focus /tmp/a.httpie` |\n| 3. 导出到 `/tmp/a.raw` | `:export.file raw @focus  /tmp/a.raw` |\n| 4. 导出到 `/tmp/a.request` | `:export.file raw_request @focus /tmp/a.request` |\n| 5. 导出到 `/tmp/a.response` | `:export.file raw_response @focus /tmp/a.response` |"
    },
    {
      "id": "s1-16",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "将流程导出到系统剪贴板"
    },
    {
      "id": "s1-17",
      "sectionId": "s1",
      "title": "流（视图）",
      "kind": "text",
      "body": ":---|---\n:---|---\n`A`        | 恢复所有拦截的流\n`D`        | 重复流\n`F`        | 设置焦点跟随\n`L`        | 从文件加载流\n`M`        | 切换查看标记流\n`S`        | 开始服务器回放\n`U`        | 取消设置所有标记\n`V`        | 还原对此流的更改\n`X`        | 杀死这个流\n`Z`        | 清除所有未显示的流\n`a`        | 恢复此拦截流\n`b`        | 将响应主体保存到文件\n`d`        | 从视图中删除流\n`e`        | 将此流导出到文件\n`f`        | 设置视图过滤器\n`m`        | 在此流程上切换标记\n`n`        | 创建新流程\n`o`        | 设置流列表顺序\n`r`        | 重播此流程\n`v`        | 反向流列表顺序\n`w`        | 将列出的流程保存到文件\n`\\|`       | 在此流上运行脚本\n`Ctrl` `l` | 将剪辑发送到剪贴板"
    },
    {
      "id": "s1-18",
      "sectionId": "s1",
      "title": "常见的快捷键",
      "kind": "text",
      "body": ":---|---\n:---|---\n`q`     | 返回/退出\n`z`     | 清除流列表\n`:`     | 命令提示符\n`E`     | 查看事件日志\n`O`     | 查看选项\n`r`     | 重播此流程\n`Tab`   | 下一个\n`Enter` | 选择"
    },
    {
      "id": "s1-19",
      "sectionId": "s1",
      "title": "全局键绑定",
      "kind": "text",
      "body": ":---|---\n:---|---\n`-`            | 循环到下一个布局\n`?`            | 查看帮助\n`B`            | 启动附加的浏览器\n`C`            | 查看命令\n`I`            | 切换拦截\n`K`            | 查看按键绑定\n`P`            | 查看流程详细信息\n`Q`            | 立即退出\n`W`            | 流式传输到文件\n`i`            | 设置拦截\n`Ctrl` `right` | 聚焦下一个布局窗格\n`Shift` `tab`  | 聚焦下一个布局窗格"
    },
    {
      "id": "s1-20",
      "sectionId": "s1",
      "title": "代理选项",
      "kind": "text",
      "body": ":---|---\n:---|---\n`-b ADDR`, `--bind-address ADDR` | 将代理绑定到的地址（默认为所有接口）\n`-I HOST`, `--ignore HOST` | 忽略主机并转发所有流量而不对其进行处理。在透明模式下，建议使用 IP 地址（范围），而不是主机名。在常规模式下，仅忽略 SSL 流量并应使用主机名。提供的值被解释为正则表达式并匹配 ip 或主机名。可以多次通过\n`--tcp HOST` | 与模式匹配的所有主机的通用 TCP SSL 代理模式。类似于 `--ignore`，但 SSL 连接被拦截。通信内容以详细模式打印到日志中\n`-n`, `--no-server` | 不要启动代理服务器。用于离线分析以前捕获的流\n`-p PORT`, `--port PORT` | 代理服务端口。默认值：`8080`\n`--http2`, `--no-http2` | 显式启用/禁用 `HTTP/2` 支持。默认情况下禁用，直到主要网站正确实施规范。默认值将在未来版本中更改\n`--no-websocket`, `--websocket` | 显式启用/禁用 `WebSocket` 支持。默认启用\n`--raw-tcp`, `--no-raw-tcp` | 显式启用/禁用实验性原始 `TCP` 支持。默认情况下禁用。默认值将在未来版本中更改\n`--spoof-source-address` | 使用客户端的 IP 进行服务器端连接。与 `–upstream-bind-address` 结合使用以欺骗固定源地址\n`--upstream-bind-address UPSTREAM_BIND_ADDRESS` | 将上游请求绑定到的地址（默认为无）"
    },
    {
      "id": "s2-21",
      "sectionId": "s2",
      "title": "过滤器",
      "kind": "text",
      "body": ":---|---\n:---|---\n`f` | 设置视图过滤器 _(在流视图页面上)_"
    },
    {
      "id": "s2-22",
      "sectionId": "s2",
      "title": "",
      "kind": "text",
      "body": "• [RegEX 备忘清单](./regex.md) _(jaywcjlove.github.io)_"
    },
    {
      "id": "s2-23",
      "sectionId": "s2",
      "title": "",
      "kind": "text",
      "body": "正则表达式是 Python 风格的，可以指定为带引号的字符串"
    },
    {
      "id": "s2-24",
      "sectionId": "s2",
      "title": "运算符",
      "kind": "text",
      "body": ":---|---\n:---|---\n`!`     | 一元非\n`&`     | 和\n`\\|`     | 或者\n`(...)` | 分组"
    },
    {
      "id": "s2-25",
      "sectionId": "s2",
      "title": "表达式",
      "kind": "text",
      "body": ":---|---\n:---|---\n`~a`           | 响应匹配资源：CSS、Javascript、Flash、图像。\n`~b` `regex`   | 主体 Body\n`~bq` `regex`  | 请求正文\n`~bs` `regex`  | 响应体\n`~c` `int`     | HTTP 响应代码\n`~d` `regex`   | 域\n`~dst` `regex` | 匹配目标地址\n`~e`           | 匹配错误\n`~h` `regex`   | 标头\n`~hq` `regex`  | 请求头\n`~hs` `regex`  | 响应头\n`~http`        | 匹配 HTTP 流\n`~m` `regex`   | 方法\n`~marked`      | 匹配标记流\n`~q`           | 匹配请求无响应\n`~s`           | 匹配响应\n`~src` `regex` | 匹配源地址\n`~t` `regex`   | 内容类型标头\n`~tcp`         | 匹配 TCP 流\n`~tq` `regex`  | 请求 Content-Type 标头\n`~ts` `regex`  | 响应内容类型标头\n`~u` `regex`   | 网址\n`~websocket`   | 匹配 WebSocket 流（和 HTTP-WebSocket 握手流）"
    },
    {
      "id": "s2-26",
      "sectionId": "s2",
      "title": "流选择器",
      "kind": "text",
      "body": "表达式"
    },
    {
      "id": "s2-27",
      "sectionId": "s2",
      "title": "",
      "kind": "text",
      "body": ":---|---\n:---|---\n`@all` | 所有流程\n`@focus` | 目前关注的流程\n`@shown` | 当前显示的所有流程\n`@hidden` | 当前隐藏的所有流程\n`@marked` | 所有标记流\n`@unmarked` | 所有未标记的流"
    },
    {
      "id": "s2-28",
      "sectionId": "s2",
      "title": "",
      "kind": "text",
      "body": "mitmproxy 有一组方便的流选择器，可以在当前视图上操作"
    },
    {
      "id": "s2-29",
      "sectionId": "s2",
      "title": "示例",
      "kind": "text",
      "body": "包含“google.com”的网址"
    },
    {
      "id": "s2-30",
      "sectionId": "s2",
      "title": "",
      "kind": "code",
      "lang": "",
      "code": "google\\.com"
    },
    {
      "id": "s2-31",
      "sectionId": "s2",
      "title": "",
      "kind": "text",
      "body": "正文中包含字符串“test”的请求"
    },
    {
      "id": "s2-32",
      "sectionId": "s2",
      "title": "",
      "kind": "code",
      "lang": "",
      "code": "~q ~b test"
    },
    {
      "id": "s2-33",
      "sectionId": "s2",
      "title": "",
      "kind": "text",
      "body": "除了带有 text/html 内容类型的请求之外的任何内容："
    },
    {
      "id": "s2-34",
      "sectionId": "s2",
      "title": "",
      "kind": "code",
      "lang": "",
      "code": "!(~q%20%26%20~t%20%22text%2Fhtml%22)",
      "encoded": true
    },
    {
      "id": "s2-35",
      "sectionId": "s2",
      "title": "",
      "kind": "text",
      "body": "替换请求中的整个 GET 字符串（需要引号才能使其工作）："
    },
    {
      "id": "s2-36",
      "sectionId": "s2",
      "title": "",
      "kind": "code",
      "lang": "",
      "code": "%22%3A~q%20~m%20GET%3A.*%3A%2Freplacement.html%22",
      "encoded": true
    },
    {
      "id": "s3-37",
      "sectionId": "s3",
      "title": "Custom%20response",
      "kind": "code",
      "lang": "python",
      "code": "from%20mitmproxy%20import%20http%0Adef%20request(flow%3A%20http.HTTPFlow)%20-%3E%20None%3A%0A%20%20%20%20if%20flow.request.pretty_url%20%3D%3D%20%22http%3A%2F%2Fexample.com%2Fpath%22%3A%0A%20%20%20%20%20%20%20%20flow.response%20%3D%20http.HTTPResponse.make(%0A%20%20%20%20%20%20%20%20%20%20%20%20200%2C%20%20%23%20(optional)%20status%20code%0A%20%20%20%20%20%20%20%20%20%20%20%20b%22Hello%20World%22%2C%20%20%23%20(optional)%20content%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%22Content-Type%22%3A%20%22text%2Fhtml%22%7D%20%20%23%20(optional)%20headers%0A%20%20%20%20%20%20%20%20)",
      "encoded": true
    },
    {
      "id": "s3-38",
      "sectionId": "s3",
      "title": "",
      "kind": "text",
      "body": "从代理发送回复而不向远程服务器发送任何数据"
    },
    {
      "id": "s3-39",
      "sectionId": "s3",
      "title": "Add%20header",
      "kind": "code",
      "lang": "python",
      "code": "class%20AddHeader%3A%0A%20%20%20%20def%20__init__(self)%3A%0A%20%20%20%20%20%20%20%20self.num%20%3D%200%0A%20%20%20%20def%20response(self%2C%20flow)%3A%0A%20%20%20%20%20%20%20%20self.num%20%3D%20self.num%20%2B%201%0A%20%20%20%20%20%20%20%20flow.response.headers%5B%22count%22%5D%20%3D%20str(self.num)%0Aaddons%20%3D%20%5B%0A%20%20%20%20AddHeader()%0A%5D",
      "encoded": true
    },
    {
      "id": "s3-40",
      "sectionId": "s3",
      "title": "",
      "kind": "text",
      "body": "为每个响应添加一个 HTTP 标头"
    },
    {
      "id": "s4-41",
      "sectionId": "s4",
      "title": "另见",
      "kind": "text",
      "body": "• [mitmproxy addons](https://github.com/mitmproxy/mitmproxy/tree/master/examples/addons) _(github.com)_\n• [mitmproxy 文档](https://docs.mitmproxy.org/stable/) _(mitmproxy.org)_\n• [mitmproxy 开源仓库](https://github.com/mitmproxy/mitmproxy) _(github.com)_\n• [mitmproxy 备忘清单](https://www.stut-it.net/blog/2017/mitmproxy-cheatsheet.html) _(stut-it.net)_"
    }
  ],
  "source": {
    "repo": "https://github.com/jaywcjlove/reference",
    "path": "docs/mitmproxy.md",
    "ref": "main",
    "url": "https://github.com/jaywcjlove/reference/tree/main/docs/mitmproxy.md",
    "lang": "zh",
    "mode": "local"
  }
}