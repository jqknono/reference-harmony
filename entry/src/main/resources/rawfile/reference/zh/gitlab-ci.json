{
  "id": "gitlab-ci",
  "name": "GitLab CI/CD 备忘清单",
  "title": "本备忘单总结了 [GitLab CI/CD](https://docs.gitlab.com/ee/ci/yaml/#default) 常用的配置说明，以供快速参考",
  "icon": "https://raw.githubusercontent.com/jaywcjlove/reference/main/assets/gitlab-ci.svg",
  "sections": [
    {
      "id": "intro",
      "title": "简介",
      "startIndex": 0
    },
    {
      "id": "s1",
      "title": "入门",
      "startIndex": 1
    },
    {
      "id": "s2",
      "title": "关键字",
      "startIndex": 7
    },
    {
      "id": "s3",
      "title": "全局关键词",
      "startIndex": 10
    },
    {
      "id": "s4",
      "title": "workflow",
      "startIndex": 29
    },
    {
      "id": "s5",
      "title": "Job 关键词",
      "startIndex": 38
    },
    {
      "id": "s6",
      "title": "artifacts",
      "startIndex": 108
    },
    {
      "id": "s7",
      "title": "cache",
      "startIndex": 128
    },
    {
      "id": "s8",
      "title": "environment",
      "startIndex": 143
    },
    {
      "id": "s9",
      "title": "image",
      "startIndex": 158
    },
    {
      "id": "s10",
      "title": "needs",
      "startIndex": 164
    },
    {
      "id": "s11",
      "title": "only / except",
      "startIndex": 174
    },
    {
      "id": "s12",
      "title": "release",
      "startIndex": 182
    },
    {
      "id": "s13",
      "title": "rules",
      "startIndex": 197
    },
    {
      "id": "s14",
      "title": "另见",
      "startIndex": 211
    }
  ],
  "cards": [
    {
      "id": "intro-0",
      "sectionId": "intro",
      "title": "简介",
      "kind": "text",
      "body": "本备忘单总结了 [GitLab CI/CD](https://docs.gitlab.com/ee/ci/yaml/#default) 常用的配置说明，以供快速参考"
    },
    {
      "id": "s1-1",
      "sectionId": "s1",
      "title": "介绍",
      "kind": "text",
      "body": "创建并运行您的第一个 GitLab `CI/CD` 管道，在开始之前，请确保您拥有："
    },
    {
      "id": "s1-2",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "• GitLab 中您想要使用 CI/CD 的项目\n• 项目的维护者或所有者角色"
    },
    {
      "id": "s1-3",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "如果您没有项目，可以在 <https://gitlab.com> 上免费创建一个公共项目"
    },
    {
      "id": "s1-4",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "• 在存储库的根目录下创建一个 `.gitlab-ci.yml` 文件。该文件是您定义 `CI/CD` 作业的地方\n• 转到`Settings` > `CI/CD` 并展开运行程序，只要您至少有一个运行器处于活动状态，旁边有一个绿色圆圈，您就有一个运行器可以处理您的工作"
    },
    {
      "id": "s1-5",
      "sectionId": "s1",
      "title": "%E7%A4%BA%E4%BE%8B",
      "kind": "code",
      "lang": "yml",
      "code": "default%3A%0A%20%20image%3A%20node%3A16%0A%0Awindows_job%3A%0A%20%20only%3A%0A%20%20%20%20-%20master%0A%20%20tags%3A%0A%20%20%20%20-%20windows%0A%20%20script%3A%0A%20%20%20%20-%20echo%20Hello%2C%20%25USERNAME%25!%0A%0Alinux_job%3A%0A%20%20tags%3A%0A%20%20%20%20-%20linux%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22Hello%2C%20%24USER!%22",
      "encoded": true
    },
    {
      "id": "s1-6",
      "sectionId": "s1",
      "title": "",
      "kind": "text",
      "body": "`tags` 用于在不同的平台上运行作业，`only` 控制 `master` 分支提交触发"
    },
    {
      "id": "s2-7",
      "sectionId": "s2",
      "title": "关键字",
      "kind": "text",
      "body": "关键字 | 描述\n:-- | --\n[default](#default) | 工作关键字的自定义默认值 [#](https://docs.gitlab.com/ee/ci/yaml/#default)\n[include](#include) | 从其他 YAML 文件导入配置 [#](https://docs.gitlab.com/ee/ci/yaml/#include)\n[stages](#stages) | 管道阶段的名称和顺序 [#](https://docs.gitlab.com/ee/ci/yaml/#stages)\n[variables](#variables) | 为管道中的所有作业定义 CI/CD 变量 [#](https://docs.gitlab.com/ee/ci/yaml/#variables)\n[workflow](#workflow) | 控制运行什么类型的管道 [#](https://docs.gitlab.com/ee/ci/yaml/#workflow)"
    },
    {
      "id": "s2-8",
      "sectionId": "s2",
      "title": "关键字",
      "kind": "text",
      "body": "关键字 | 描述\n:-- | --\n[after_script](#after_script) | 覆盖一组在作业之后执行的命令 [#](https://docs.gitlab.com/ee/ci/yaml/#after_script)\n[allow_failure](#allow_failure) | 允许作业失败。失败的作业不会导致管道失败 [#](https://docs.gitlab.com/ee/ci/yaml/#allow_failure)\n[artifacts](#artifacts) | 成功时附加到作业的文件和目录列表 [#](https://docs.gitlab.com/ee/ci/yaml/#artifacts)\n[before_script](#before_script) | 覆盖在作业之前执行的一组命令 [#](https://docs.gitlab.com/ee/ci/yaml/#before_script)\n[cache](#cache) | 应在后续运行之间缓存的文件列表 [#](https://docs.gitlab.com/ee/ci/yaml/#cache)\n[coverage](#coverage) | 给定作业的代码覆盖率设置 [#](https://docs.gitlab.com/ee/ci/yaml/#coverage)\n[dast_configuration](#dast_configuration) | 在作业级别使用 DAST 配置文件中的配置 [#](https://docs.gitlab.com/ee/ci/yaml/#dast_configuration)\n[dependencies](#dependencies) | 通过提供要从中获取工件的作业列表来限制将哪些工件传递给特定作业 [#](https://docs.gitlab.com/ee/ci/yaml/#dependencies)\n[environment](#environment) | 作业部署到的环境的名称 [#](https://docs.gitlab.com/ee/ci/yaml/#environment)\n[except](#only--except) | 控制何时不创建作业 [#](https://docs.gitlab.com/ee/ci/yaml/#only--except)\n[extends](#extends) | 此作业继承自的配置条目 [#](https://docs.gitlab.com/ee/ci/yaml/#extends)\n[image](#image) | 使用 Docker 镜像 [#](https://docs.gitlab.com/ee/ci/yaml/#image)\n[inherit](#inherit) | 选择所有作业继承的全局默认值 [#](https://docs.gitlab.com/ee/ci/yaml/#inherit)\n[interruptible](#interruptible) | 定义作业是否可以在被较新的运行冗余时取消 [#](https://docs.gitlab.com/ee/ci/yaml/#interruptible)\n[needs](#needs) | 在阶段排序之前执行作业 [#](https://docs.gitlab.com/ee/ci/yaml/#needs)\n[only](#only--except) | 控制何时创建作业 [#](https://docs.gitlab.com/ee/ci/yaml/#only--except)\n[pages](#pages) | 上传作业的结果以与 GitLab Pages 一起使用 [#](https://docs.gitlab.com/ee/ci/yaml/#pages)\n[parallel](#parallel) | 应并行运行多少个作业实例 [#](https://docs.gitlab.com/ee/ci/yaml/#parallel)\n[release](#release) | 指示运行器生成释放对象 [#](https://docs.gitlab.com/ee/ci/yaml/#release)\n[resource_group](#resource_group) | 限制作业并发 [#](https://docs.gitlab.com/ee/ci/yaml/#resource_group)\n[retry](#retry) | 发生故障时可以自动重试作业的时间和次数 [#](https://docs.gitlab.com/ee/ci/yaml/#retry)\n[rules](#rules) | 用于评估和确定作业的选定属性以及是否创建的条件列表 [#](https://docs.gitlab.com/ee/ci/yaml/#rules)\n[script](#script) | 由运行器执行的 Shell 脚本 [#](https://docs.gitlab.com/ee/ci/yaml/#script)\n[secrets](#secrets) | CI/CD 保密工作需要 [#](https://docs.gitlab.com/ee/ci/yaml/#secrets)\n[services](#services) | 使用 Docker 服务映像 [#](https://docs.gitlab.com/ee/ci/yaml/#services)\n[stage](#stage) | 定义作业阶段 [#](https://docs.gitlab.com/ee/ci/yaml/#stage)\n[tags](#tags) | 用于选择跑步者的标签列表 [#](https://docs.gitlab.com/ee/ci/yaml/#tags)\n[timeout](#timeout) | 定义优先于项目范围设置的自定义作业级超时 [#](https://docs.gitlab.com/ee/ci/yaml/#timeout)\n[trigger](#trigger) | 定义下游管道触发器 [#](https://docs.gitlab.com/ee/ci/yaml/#trigger)\n[variables](#variables) | 在作业级别定义作业变量 [#](https://docs.gitlab.com/ee/ci/yaml/#variables)\n[when](#when) | 何时运行作业 [#](https://docs.gitlab.com/ee/ci/yaml/#when)"
    },
    {
      "id": "s2-9",
      "sectionId": "s2",
      "title": "全局关键词",
      "kind": "text",
      "body": "• [after_script](#after_script)\n• [artifacts](#artifacts)\n• [before_script](#before_script)\n• [cache](#cache)\n• [image](#image)\n• [interruptible](#interruptible)\n• [retry](#retry)\n• [services](#services)\n• [tags](#tags)\n• [timeout](#timeout)"
    },
    {
      "id": "s3-10",
      "sectionId": "s3",
      "title": "default",
      "kind": "code",
      "lang": "yml",
      "code": "default:\n  image: ruby:3.0\n\nrspec:\n  script: bundle exec rspec\n\nrspec 2.7:\n  image: ruby:2.7\n  script: bundle exec rspec"
    },
    {
      "id": "s3-11",
      "sectionId": "s3",
      "title": "",
      "kind": "text",
      "body": "在此示例中，`ruby:3.0` 是管道中所有作业的默认图像值。`rspec 2.7` 作业不使用默认值，因为它使用特定于作业的图像部分覆盖了默认值"
    },
    {
      "id": "s3-12",
      "sectionId": "s3",
      "title": "include",
      "kind": "code",
      "lang": "yml",
      "code": "include:\n  - local: '/temp/.gitlab-ci-template.yml'"
    },
    {
      "id": "s3-13",
      "sectionId": "s3",
      "title": "",
      "kind": "text",
      "body": "在 `11.4` 中移至 `GitLab` 免费版，使用 `include` 将外部 `YAML` 文件包含在您的 `CI/CD` 配置中"
    },
    {
      "id": "s3-14",
      "sectionId": "s3",
      "title": "include:local",
      "kind": "code",
      "lang": "yml",
      "code": "include:\n  - local: '/temp/.gitlab-ci-template.yml'"
    },
    {
      "id": "s3-15",
      "sectionId": "s3",
      "title": "",
      "kind": "text",
      "body": "使用 `include:local` 包含与 `.gitlab-ci.yml` 文件位于同一存储库中的文件"
    },
    {
      "id": "s3-16",
      "sectionId": "s3",
      "title": "include:project",
      "kind": "text",
      "body": "要在同一个 GitLab 实例上包含来自另一个私有项目的文件，请使用 `include:project` 和 `include:file`"
    },
    {
      "id": "s3-17",
      "sectionId": "s3",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "include:\n  - project: 'group/my-project'\n    file: '/temp/.gitlab-ci-template.yml'\n  - project: 'group/subgroup/my-project-2'\n    file:\n      - '/temp/.builds.yml'\n      - '/temp/.tests.yml'"
    },
    {
      "id": "s3-18",
      "sectionId": "s3",
      "title": "",
      "kind": "text",
      "body": "您还可以指定一个 `ref`："
    },
    {
      "id": "s3-19",
      "sectionId": "s3",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "include:\n  - project: 'group/my-project'\n    ref: main    # Git branch\n    file: '/templates/.gitlab-ci.yml'\n  - project: 'group/my-project'\n    ref: v1.0.0   # Git Tag\n    file: '/templates/.gitlab-ci.yml'\n  - project: 'group/my-project'\n    ref: 787123b  # Git SHA\n    file: '/templates/.gitlab-ci.yml'"
    },
    {
      "id": "s3-20",
      "sectionId": "s3",
      "title": "include:remote",
      "kind": "code",
      "lang": "yml",
      "code": "include:\n  - remote: 'https://gitlab.com/example-project/-/raw/main/.gitlab-ci.yml'"
    },
    {
      "id": "s3-21",
      "sectionId": "s3",
      "title": "",
      "kind": "text",
      "body": "使用带有完整 `URL` 的 `include:remote` 来包含来自不同位置的文件"
    },
    {
      "id": "s3-22",
      "sectionId": "s3",
      "title": "include:template",
      "kind": "text",
      "body": "使用 `include:template` 来包含 `.gitlab-ci.yml` 模板"
    },
    {
      "id": "s3-23",
      "sectionId": "s3",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "# 文件来自 GitLab 模板集合\ninclude:\n  - template: Auto-DevOps.gitlab-ci.yml"
    },
    {
      "id": "s3-24",
      "sectionId": "s3",
      "title": "",
      "kind": "text",
      "body": "多个 `include:template` 文件："
    },
    {
      "id": "s3-25",
      "sectionId": "s3",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "include:\n  - template: Android-Fastlane.gitlab-ci.yml\n  - template: Auto-DevOps.gitlab-ci.yml"
    },
    {
      "id": "s3-26",
      "sectionId": "s3",
      "title": "stages",
      "kind": "text",
      "body": "使用阶段来定义包含作业组的阶段。如果 `.gitlab-ci.yml` 文件中未定义阶段，则默认管道阶段为："
    },
    {
      "id": "s3-27",
      "sectionId": "s3",
      "title": "",
      "kind": "text",
      "body": "• [.pre](#stage-pre)\n• build\n• test\n• deploy\n• [.post](#stage-post)"
    },
    {
      "id": "s3-28",
      "sectionId": "s3",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "stages:\n  - build\n  - test\n  - deploy"
    },
    {
      "id": "s4-29",
      "sectionId": "s4",
      "title": "workflow:name",
      "kind": "text",
      "body": "您可以在 workflow: 中使用 name 来定义管道的名称"
    },
    {
      "id": "s4-30",
      "sectionId": "s4",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "workflow:\n  name: '分支管道：$CI_COMMIT_BRANCH'"
    },
    {
      "id": "s4-31",
      "sectionId": "s4",
      "title": "",
      "kind": "text",
      "body": "根据管道条件具有不同管道名称的配置："
    },
    {
      "id": "s4-32",
      "sectionId": "s4",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "variables%3A%0A%20%20PIPELINE_NAME%3A%20'%E9%BB%98%E8%AE%A4%E7%AE%A1%E9%81%93%E5%90%8D%E7%A7%B0'%0A%0Aworkflow%3A%0A%20%20name%3A%20'%24PIPELINE_NAME'%0A%20%20rules%3A%0A%20%20%20%20-%20if%3A%20'%24CI_PIPELINE_SOURCE%20%3D%3D%20%22merge_request_event%22'%0A%20%20%20%20%20%20variables%3A%0A%20%20%20%20%20%20%20%20PIPELINE_NAME%3A%20'MR%20pipeline%3A%20%24CI_COMMIT_BRANCH'%0A%20%20%20%20-%20if%3A%20'%24CI_MERGE_REQUEST_LABELS%20%3D~%20%2Fpipeline%3Arun-in-ruby3%2F'%0A%20%20%20%20%20%20variables%3A%0A%20%20%20%20%20%20%20%20PIPELINE_NAME%3A%20'Ruby%203%20pipeline'",
      "encoded": true
    },
    {
      "id": "s4-33",
      "sectionId": "s4",
      "title": "workflow:rules:variables",
      "kind": "text",
      "body": "您可以在 `workflow:rules` 中使用变量来定义特定管道条件的变量"
    },
    {
      "id": "s4-34",
      "sectionId": "s4",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "variables%3A%0A%20%20DEPLOY_VARIABLE%3A%20%22default-deploy%22%0A%0Aworkflow%3A%0A%20%20rules%3A%0A%20%20%20%20-%20if%3A%20%24CI_COMMIT_REF_NAME%20%3D%3D%20%24CI_DEFAULT_BRANCH%0A%20%20%20%20%20%20variables%3A%0A%20%20%20%20%20%20%20%20DEPLOY_VARIABLE%3A%20%22deploy-production%22%20%20%23%20%E8%A6%86%E7%9B%96%E5%85%A8%E5%B1%80%E5%AE%9A%E4%B9%89%E7%9A%84%20DEPLOY_VARIABLE%0A%20%20%20%20-%20if%3A%20%24CI_COMMIT_REF_NAME%20%3D~%20%2Ffeature%2F%0A%20%20%20%20%20%20variables%3A%0A%20%20%20%20%20%20%20%20IS_A_FEATURE%3A%20%22true%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E6%96%B0%E5%8F%98%E9%87%8F%0A%20%20%20%20-%20when%3A%20always%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E5%9C%A8%E5%85%B6%E4%BB%96%E6%83%85%E5%86%B5%E4%B8%8B%E8%BF%90%E8%A1%8C%E7%AE%A1%E9%81%93%0A%0Ajob1%3A%0A%20%20variables%3A%0A%20%20%20%20DEPLOY_VARIABLE%3A%20%22job1-default-deploy%22%0A%20%20rules%3A%0A%20%20%20%20-%20if%3A%20%24CI_COMMIT_REF_NAME%20%3D%3D%20%24CI_DEFAULT_BRANCH%0A%20%20%20%20%20%20variables%3A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E8%A6%86%E7%9B%96%E5%AE%9A%E4%B9%89%E7%9A%84%20DEPLOY_VARIABLE%0A%20%20%20%20%20%20%20%20DEPLOY_VARIABLE%3A%20%22job1-deploy-production%22%20%20%23%20%E5%9C%A8%E5%B7%A5%E4%BD%9C%E5%B1%82%E9%9D%A2%E3%80%82%0A%20%20%20%20-%20when%3A%20on_success%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E5%9C%A8%E5%85%B6%E4%BB%96%E6%83%85%E5%86%B5%E4%B8%8B%E8%BF%90%E8%A1%8C%E4%BD%9C%E4%B8%9A%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E4%BB%A5%20%24DEPLOY_VARIABLE%20%E4%BD%9C%E4%B8%BA%E5%8F%82%E6%95%B0%E8%BF%90%E8%A1%8C%E8%84%9A%E6%9C%AC%22%0A%20%20%20%20-%20echo%20%22%E5%A6%82%E6%9E%9C%20%24IS_A_FEATURE%20%E5%AD%98%E5%9C%A8%E5%88%99%E8%BF%90%E8%A1%8C%E5%8F%A6%E4%B8%80%E4%B8%AA%E8%84%9A%E6%9C%AC%22%0A%0Ajob2%3A%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E4%BB%A5%20%24DEPLOY_VARIABLE%20%E4%BD%9C%E4%B8%BA%E5%8F%82%E6%95%B0%E8%BF%90%E8%A1%8C%E8%84%9A%E6%9C%AC%22%0A%20%20%20%20-%20echo%20%22%E5%A6%82%E6%9E%9C%20%24IS_A_FEATURE%20%E5%AD%98%E5%9C%A8%E5%88%99%E8%BF%90%E8%A1%8C%E5%8F%A6%E4%B8%80%E4%B8%AA%E8%84%9A%E6%9C%AC%22",
      "encoded": true
    },
    {
      "id": "s4-35",
      "sectionId": "s4",
      "title": "workflow:rules",
      "kind": "text",
      "body": "工作流(workflow)中的 `rules` 关键字类似于作业中定义的 [`rules`](#rules)，但控制是否创建整个管道"
    },
    {
      "id": "s4-36",
      "sectionId": "s4",
      "title": "",
      "kind": "text",
      "body": "• [rules: if](#rulesif)\n• [rules: changes](#ruleschanges)\n• [rules: exists](#rulesexists)\n• [when](#when)\n• [variables](#workflowrulesvariables)"
    },
    {
      "id": "s4-37",
      "sectionId": "s4",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "workflow%3A%0A%20%20rules%3A%0A%20%20%20%20-%20if%3A%20%24CI_COMMIT_TITLE%20%3D~%20%2F-draft%24%2F%0A%20%20%20%20%20%20when%3A%20never%0A%20%20%20%20-%20if%3A%20%24CI_PIPELINE_SOURCE%20%3D%3D%20%22merge_request_event%22%0A%20%20%20%20-%20if%3A%20%24CI_COMMIT_BRANCH%20%3D%3D%20%24CI_DEFAULT_BRANCH",
      "encoded": true
    },
    {
      "id": "s5-38",
      "sectionId": "s5",
      "title": "after_script",
      "kind": "text",
      "body": "在每个作业（包括失败的作业）**之后**运行的命令数组"
    },
    {
      "id": "s5-39",
      "sectionId": "s5",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "job%3A%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E7%A4%BA%E4%BE%8B%E8%84%9A%E6%9C%AC%E9%83%A8%E5%88%86%22%0A%20%20after_script%3A%0A%20%20%20%20-%20echo%20%22%E5%9C%A8%E2%80%9Cscript%E2%80%9D%E9%83%A8%E5%88%86%E5%AE%8C%E6%88%90%E5%90%8E%E6%89%A7%E8%A1%8C%E6%AD%A4%E5%91%BD%E4%BB%A4%22",
      "encoded": true
    },
    {
      "id": "s5-40",
      "sectionId": "s5",
      "title": "allow_failure",
      "kind": "text",
      "body": "确定管道是否应在作业失败时继续运行"
    },
    {
      "id": "s5-41",
      "sectionId": "s5",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "job1:\n  stage: test\n  script:\n    - execute_script_1\n\njob2:\n  stage: test\n  script:\n    - execute_script_2\n  allow_failure: true\n\njob3:\n  stage: deploy\n  script:\n    - deploy_to_staging\n  environment: staging"
    },
    {
      "id": "s5-42",
      "sectionId": "s5",
      "title": "allow_failure:exit_codes",
      "kind": "text",
      "body": "控制何时允许作业失败。对于任何列出的退出代码，作业是 `allow_failure: true`，对于任何其他退出代码，`allow_failure` false"
    },
    {
      "id": "s5-43",
      "sectionId": "s5",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "test_job_1%3A%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E9%80%80%E5%87%BA%E4%BB%A3%E7%A0%81%201%20%E7%9A%84%E8%84%9A%E6%9C%AC%E3%80%82%E6%AD%A4%E4%BD%9C%E4%B8%9A%E5%A4%B1%E8%B4%A5%22%0A%20%20%20%20-%20exit%201%0A%20%20allow_failure%3A%0A%20%20%20%20exit_codes%3A%20137%0A%0Atest_job_2%3A%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E9%80%80%E5%87%BA%E4%BB%A3%E7%A0%81%20137%20%E7%9A%84%E8%84%9A%E6%9C%AC%E5%85%81%E8%AE%B8%E6%AD%A4%E4%BD%9C%E4%B8%9A%E5%A4%B1%E8%B4%A5%22%0A%20%20%20%20-%20exit%20137%0A%20%20allow_failure%3A%0A%20%20%20%20exit_codes%3A%0A%20%20%20%20%20%20-%20137%0A%20%20%20%20%20%20-%20255",
      "encoded": true
    },
    {
      "id": "s5-44",
      "sectionId": "s5",
      "title": "dast_configuration",
      "kind": "code",
      "lang": "yml",
      "code": "stages%3A%0A%20%20-%20build%0A%20%20-%20dast%0A%0Ainclude%3A%0A%20%20-%20template%3A%20DAST.gitlab-ci.yml%0A%0Adast%3A%0A%20%20dast_configuration%3A%0A%20%20%20%20site_profile%3A%20%22Example%20Co%22%0A%20%20%20%20scanner_profile%3A%20%22Quick%20Passive%20Test%22",
      "encoded": true
    },
    {
      "id": "s5-45",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "指定要在 CI/CD 配置中使用的站点配置文件和扫描仪配置文件。 两个配置文件必须首先在项目中创建。 作业的阶段必须快"
    },
    {
      "id": "s5-46",
      "sectionId": "s5",
      "title": "before_script",
      "kind": "text",
      "body": "在每个作业的 `script` 命令之前运行，但在工件恢复之后运行"
    },
    {
      "id": "s5-47",
      "sectionId": "s5",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "job%3A%0A%20%20before_script%3A%0A%20%20%20%20-%20echo%20%22%E5%9C%A8%E4%BB%BB%E4%BD%95%E2%80%9Cscript%3A%E2%80%9D%E5%91%BD%E4%BB%A4%E4%B9%8B%E5%89%8D%E6%89%A7%E8%A1%8C%E6%AD%A4%E5%91%BD%E4%BB%A4%22%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E2%80%9Cbefore_script%E2%80%9D%E5%91%BD%E4%BB%A4%E4%B9%8B%E5%90%8E%E6%89%A7%E8%A1%8C%22",
      "encoded": true
    },
    {
      "id": "s5-48",
      "sectionId": "s5",
      "title": "coverage",
      "kind": "code",
      "lang": "yml",
      "code": "job1:\n  script: rspec\n  coverage: '/Code coverage: \\d+\\.\\d+/'"
    },
    {
      "id": "s5-49",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "使用自定义正则表达式的覆盖率来配置如何从作业输出中提取代码覆盖率"
    },
    {
      "id": "s5-50",
      "sectionId": "s5",
      "title": "extends",
      "kind": "code",
      "lang": "yml",
      "code": ".tests:\n  script: rake test\n  stage: test\n  only:\n    refs:\n      - branches\n\nrspec:\n  extends: .tests\n  script: rake rspec\n  only:\n    variables:\n      - $RSPEC"
    },
    {
      "id": "s5-51",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "使用 `extends` 重用配置部分。 它是 YAML 锚点的替代品，并且更加灵活和可读"
    },
    {
      "id": "s5-52",
      "sectionId": "s5",
      "title": "dependencies",
      "kind": "code",
      "lang": "yml",
      "code": "build osx:\n  stage: build\n  script: make build:osx\n  artifacts:\n    paths:\n      - binaries/\n\nbuild linux:\n  stage: build\n  script: make build:linux\n  artifacts:\n    paths:\n      - binaries/\n\ntest osx:\n  stage: test\n  script: make test:osx\n  dependencies:\n    - build osx\n\ntest linux:\n  stage: test\n  script: make test:linux\n  dependencies:\n    - build linux\n\ndeploy:\n  stage: deploy\n  script: make deploy\n  environment: production"
    },
    {
      "id": "s5-53",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "定义要从中获取工件的作业列表。您还可以将作业设置为根本不下载任何工件"
    },
    {
      "id": "s5-54",
      "sectionId": "s5",
      "title": "inherit",
      "kind": "text",
      "body": "使用 inherit 控制默认关键字和变量的继承"
    },
    {
      "id": "s5-55",
      "sectionId": "s5",
      "title": "inherit:default",
      "kind": "text",
      "body": "使用 `inherit:default` 控制 `default` 关键字的继承"
    },
    {
      "id": "s5-56",
      "sectionId": "s5",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "default%3A%0A%20%20retry%3A%202%0A%20%20image%3A%20ruby%3A3.0%0A%20%20interruptible%3A%20true%0A%0Ajob1%3A%0A%20%20script%3A%20echo%20%22%E6%AD%A4%E4%BD%9C%E4%B8%9A%E4%B8%8D%E7%BB%A7%E6%89%BF%E4%BB%BB%E4%BD%95%E9%BB%98%E8%AE%A4%E5%85%B3%E9%94%AE%E5%AD%97%22%0A%20%20inherit%3A%0A%20%20%20%20default%3A%20false%0A%0Ajob2%3A%0A%20%20script%3A%20echo%20%22%E6%AD%A4%E4%BD%9C%E4%B8%9A%E4%BB%85%E7%BB%A7%E6%89%BF%E5%88%97%E5%87%BA%E7%9A%84%E4%B8%A4%E4%B8%AA%E9%BB%98%E8%AE%A4%E5%85%B3%E9%94%AE%E5%AD%97%E3%80%82%E5%AE%83%E4%B8%8D%E7%BB%A7%E6%89%BF%E2%80%9C%E5%8F%AF%E4%B8%AD%E6%96%AD%E2%80%9D%22%0A%20%20inherit%3A%0A%20%20%20%20default%3A%0A%20%20%20%20%20%20-%20retry%0A%20%20%20%20%20%20-%20image",
      "encoded": true
    },
    {
      "id": "s5-57",
      "sectionId": "s5",
      "title": "inherit:variables",
      "kind": "text",
      "body": "使用 inherit:variables 控制全局变量关键字的继承"
    },
    {
      "id": "s5-58",
      "sectionId": "s5",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "variables%3A%0A%20%20VARIABLE1%3A%20%22%E8%BF%99%E6%98%AF%E5%8F%98%E9%87%8F%201%22%0A%20%20VARIABLE2%3A%20%22%E8%BF%99%E6%98%AF%E5%8F%98%E9%87%8F%202%22%0A%20%20VARIABLE3%3A%20%22%E8%BF%99%E6%98%AF%E5%8F%98%E9%87%8F%203%22%0A%0Ajob1%3A%0A%20%20script%3A%20echo%20%22%E8%AF%A5%E4%BD%9C%E4%B8%9A%E4%B8%8D%E7%BB%A7%E6%89%BF%E4%BB%BB%E4%BD%95%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%22%0A%20%20inherit%3A%0A%20%20%20%20variables%3A%20false%0A%0Ajob2%3A%0A%20%20script%3A%20echo%20%22%E6%AD%A4%E4%BD%9C%E4%B8%9A%E4%BB%85%E7%BB%A7%E6%89%BF%E5%88%97%E5%87%BA%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E3%80%82%E5%AE%83%E4%B8%8D%E7%BB%A7%E6%89%BF%E2%80%9CVARIABLE3%E2%80%9D%22%0A%20%20inherit%3A%0A%20%20%20%20variables%3A%0A%20%20%20%20%20%20-%20VARIABLE1%0A%20%20%20%20%20%20-%20VARIABLE2",
      "encoded": true
    },
    {
      "id": "s5-59",
      "sectionId": "s5",
      "title": "interruptible",
      "kind": "code",
      "lang": "yml",
      "code": "stages%3A%0A%20%20-%20stage1%0A%20%20-%20stage2%0A%20%20-%20stage3%0A%0Astep-1%3A%0A%20%20stage%3A%20stage1%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E5%8F%AF%E4%BB%A5%E5%8F%96%E6%B6%88%22%0A%20%20interruptible%3A%20true%0A%0Astep-2%3A%0A%20%20stage%3A%20stage2%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E4%B8%8D%E8%83%BD%E5%8F%96%E6%B6%88%22%0A%0Astep-3%3A%0A%20%20stage%3A%20stage3%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E5%9B%A0%E4%B8%BA%E7%AC%AC%202%20%E6%AD%A5%E6%97%A0%E6%B3%95%E5%8F%96%E6%B6%88%EF%BC%8C%E6%89%80%E4%BB%A5%E6%AD%A4%E6%AD%A5%E9%AA%A4%E6%B0%B8%E8%BF%9C%E6%97%A0%E6%B3%95%E5%8F%96%E6%B6%88%EF%BC%8C%E5%8D%B3%E4%BD%BF%E5%AE%83%E8%A2%AB%E8%AE%BE%E7%BD%AE%E4%B8%BA%E5%8F%AF%E4%B8%AD%E6%96%AD%22%0A%20%20interruptible%3A%20true",
      "encoded": true
    },
    {
      "id": "s5-60",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "如果在作业完成之前启动较新的管道时应取消作业，则使用可中断的"
    },
    {
      "id": "s5-61",
      "sectionId": "s5",
      "title": "pages",
      "kind": "code",
      "lang": "yml",
      "code": "pages:\n  stage: deploy\n  script:\n    - mkdir .public\n    - cp -r * .public\n    - mv .public public\n  artifacts:\n    paths:\n      - public\n  rules:\n    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH\n  environment: production"
    },
    {
      "id": "s5-62",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "使用页面定义将静态内容上传到 `GitLab` 的 `GitLab Pages` 作业。然后将内容发布为网站"
    },
    {
      "id": "s5-63",
      "sectionId": "s5",
      "title": "parallel",
      "kind": "code",
      "lang": "yml",
      "code": "test:\n  script: rspec\n  parallel: 5"
    },
    {
      "id": "s5-64",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "使用 `parallel` 在单个管道中并行多次运行作业"
    },
    {
      "id": "s5-65",
      "sectionId": "s5",
      "title": "parallel:matrix",
      "kind": "code",
      "lang": "yml",
      "code": "deploystacks:\n  stage: deploy\n  script:\n    - bin/deploy\n  parallel:\n    matrix:\n      - PROVIDER: aws\n        STACK:\n          - monitoring\n          - app1\n          - app2\n      - PROVIDER: ovh\n        STACK: [monitoring, backup, app]\n      - PROVIDER: [gcp, vultr]\n        STACK: [data, processing]\n  environment: $PROVIDER/$STACK"
    },
    {
      "id": "s5-66",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "使用 `parallel:matrix` 在单个管道中并行多次运行作业，但每个作业实例具有不同的变量值"
    },
    {
      "id": "s5-67",
      "sectionId": "s5",
      "title": "resource_group",
      "kind": "code",
      "lang": "yml",
      "code": "deploy-to-production:\n  script: deploy\n  resource_group: production"
    },
    {
      "id": "s5-68",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "创建一个资源组，以确保作业在同一项目的不同管道之间互斥"
    },
    {
      "id": "s5-69",
      "sectionId": "s5",
      "title": "tags",
      "kind": "code",
      "lang": "yml",
      "code": "job:\n  tags:\n    - ruby\n    - postgres"
    },
    {
      "id": "s5-70",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "使用标签从项目可用的所有运行器列表中选择特定运行器"
    },
    {
      "id": "s5-71",
      "sectionId": "s5",
      "title": "retry",
      "kind": "code",
      "lang": "yml",
      "code": "test:\n  script: rspec\n  retry: 2"
    },
    {
      "id": "s5-72",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "使用 `retry` 配置作业失败时重试的次数。如果未定义，则默认为 `0`，并且作业不会重试"
    },
    {
      "id": "s5-73",
      "sectionId": "s5",
      "title": "retry:when",
      "kind": "code",
      "lang": "yml",
      "code": "test:\n  script: rspec\n  retry:\n    max: 2\n    when: runner_system_failure"
    },
    {
      "id": "s5-74",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "使用 `retry:when` 和 `retry:max` 来重试特定失败案例的作业。 `retry:max` 是最大重试次数，和`retry`一样，可以是0、1、2"
    },
    {
      "id": "s5-75",
      "sectionId": "s5",
      "title": "script",
      "kind": "code",
      "lang": "yml",
      "code": "job1%3A%0A%20%20script%3A%20%22bundle%20exec%20rspec%22%0A%0Ajob2%3A%0A%20%20script%3A%0A%20%20%20%20-%20uname%20-a%0A%20%20%20%20-%20bundle%20exec%20rspec",
      "encoded": true
    },
    {
      "id": "s5-76",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "使用脚本指定运行器执行的命令"
    },
    {
      "id": "s5-77",
      "sectionId": "s5",
      "title": "secrets",
      "kind": "text",
      "body": "此关键字必须与 `secrets:vault` 一起使用"
    },
    {
      "id": "s5-78",
      "sectionId": "s5",
      "title": "secrets:vault",
      "kind": "text",
      "body": "使用 `secrets:vault` 指定 HashiCorp Vault 提供的秘密"
    },
    {
      "id": "s5-79",
      "sectionId": "s5",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "job:\n  secrets:\n    # 将秘密的路径存储在此 CI/CD 变量中\n    DATABASE_PASSWORD:\n      # 转换为秘密：`ops/data/production/db`\n      # 字段：`password`\n      vault: \n        engine:\n          name: kv-v2\n          path: ops\n        path: production/db\n        field: password"
    },
    {
      "id": "s5-80",
      "sectionId": "s5",
      "title": "secrets:file",
      "kind": "text",
      "body": "使用 `secrets:file` 将秘密配置为存储为文件或变量类型的 CI/CD 变量"
    },
    {
      "id": "s5-81",
      "sectionId": "s5",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "job:\n  secrets:\n    DATABASE_PASSWORD:\n      vault: production/db/password@ops\n      file: false"
    },
    {
      "id": "s5-82",
      "sectionId": "s5",
      "title": "timeout",
      "kind": "code",
      "lang": "yml",
      "code": "build:\n  script: build.sh\n  timeout: 3 hours 30 minutes\n\ntest:\n  script: rspec\n  timeout: 3h 30m"
    },
    {
      "id": "s5-83",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "为特定作业配置超时。 如果作业运行时间超过超时时间，则作业失败"
    },
    {
      "id": "s5-84",
      "sectionId": "s5",
      "title": "services",
      "kind": "text",
      "body": "使用服务指定额外的 `Docker` 映像以在其中运行脚本"
    },
    {
      "id": "s5-85",
      "sectionId": "s5",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "default%3A%0A%20%20image%3A%0A%20%20%20%20name%3A%20ruby%3A2.6%0A%20%20%20%20entrypoint%3A%20%5B%22%2Fbin%2Fbash%22%5D%0A%0A%20%20services%3A%0A%20%20%20%20-%20name%3A%20my-postgres%3A11.7%0A%20%20%20%20%20%20alias%3A%20db-postgres%0A%20%20%20%20%20%20entrypoint%3A%20%5B%22%2Fusr%2Flocal%2Fbin%2Fdb-postgres%22%5D%0A%20%20%20%20%20%20command%3A%20%5B%22start%22%5D%0A%0A%20%20before_script%3A%0A%20%20%20%20-%20bundle%20install%0A%0Atest%3A%0A%20%20script%3A%0A%20%20%20%20-%20bundle%20exec%20rake%20spec",
      "encoded": true
    },
    {
      "id": "s5-86",
      "sectionId": "s5",
      "title": "service:pull_policy",
      "kind": "text",
      "body": "运行器用于获取 `Docker` 映像的拉取策略"
    },
    {
      "id": "s5-87",
      "sectionId": "s5",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "job1%3A%0A%20%20script%3A%20echo%20%22A%20single%20pull%20policy.%22%0A%20%20services%3A%0A%20%20%20%20-%20name%3A%20postgres%3A11.6%0A%20%20%20%20%20%20pull_policy%3A%20if-not-present%0A%0Ajob2%3A%0A%20%20script%3A%20echo%20%22Multiple%20pull%20policies.%22%0A%20%20services%3A%0A%20%20%20%20-%20name%3A%20postgres%3A11.6%0A%20%20%20%20%20%20pull_policy%3A%20%5Balways%2C%20if-not-present%5D",
      "encoded": true
    },
    {
      "id": "s5-88",
      "sectionId": "s5",
      "title": "stage",
      "kind": "code",
      "lang": "yml",
      "code": "stages%3A%0A%20%20-%20build%0A%20%20-%20test%0A%20%20-%20deploy%0A%0Ajob1%3A%0A%20%20stage%3A%20build%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E8%BF%99%E9%A1%B9%E5%B7%A5%E4%BD%9C%E7%BC%96%E8%AF%91%E4%BB%A3%E7%A0%81%22%0A%0Ajob2%3A%0A%20%20stage%3A%20test%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E6%AD%A4%E4%BD%9C%E4%B8%9A%E6%B5%8B%E8%AF%95%E7%BC%96%E8%AF%91%E5%90%8E%E7%9A%84%E4%BB%A3%E7%A0%81%E3%80%82%E5%AE%83%E5%9C%A8%E6%9E%84%E5%BB%BA%E9%98%B6%E6%AE%B5%E5%AE%8C%E6%88%90%E6%97%B6%E8%BF%90%E8%A1%8C%22%0A%0Ajob3%3A%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E8%BF%99%E9%A1%B9%E5%B7%A5%E4%BD%9C%E4%B9%9F%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%98%B6%E6%AE%B5%E8%BF%90%E8%A1%8C%22%0A%0Ajob4%3A%0A%20%20stage%3A%20deploy%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E6%AD%A4%E4%BD%9C%E4%B8%9A%E9%83%A8%E7%BD%B2%E4%BB%A3%E7%A0%81%E3%80%82%E5%AE%83%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%98%B6%E6%AE%B5%E5%AE%8C%E6%88%90%E6%97%B6%E8%BF%90%E8%A1%8C%22%0A%20%20environment%3A%20production",
      "encoded": true
    },
    {
      "id": "s5-89",
      "sectionId": "s5",
      "title": "stage%3A%20.pre",
      "kind": "code",
      "lang": "yml",
      "code": "stages%3A%0A%20%20-%20build%0A%20%20-%20test%0A%0Ajob1%3A%0A%20%20stage%3A%20build%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E8%AF%A5%E4%BD%9C%E4%B8%9A%E5%9C%A8%E6%9E%84%E5%BB%BA%E9%98%B6%E6%AE%B5%E8%BF%90%E8%A1%8C%22%0A%0Afirst-job%3A%0A%20%20stage%3A%20.pre%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E8%AF%A5%E4%BD%9C%E4%B8%9A%E5%9C%A8%20.pre%20%E9%98%B6%E6%AE%B5%E8%BF%90%E8%A1%8C%EF%BC%8C%E5%9C%A8%E6%89%80%E6%9C%89%E5%85%B6%E4%BB%96%E9%98%B6%E6%AE%B5%E4%B9%8B%E5%89%8D%22%0A%0Ajob2%3A%0A%20%20stage%3A%20test%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E8%AF%A5%E4%BD%9C%E4%B8%9A%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%98%B6%E6%AE%B5%E8%BF%90%E8%A1%8C%22",
      "encoded": true
    },
    {
      "id": "s5-90",
      "sectionId": "s5",
      "title": "stage%3A%20.post",
      "kind": "code",
      "lang": "yml",
      "code": "stages%3A%0A%20%20-%20build%0A%20%20-%20test%0A%0Ajob1%3A%0A%20%20stage%3A%20build%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E8%AF%A5%E4%BD%9C%E4%B8%9A%E5%9C%A8%E6%9E%84%E5%BB%BA%E9%98%B6%E6%AE%B5%E8%BF%90%E8%A1%8C%22%0A%0Alast-job%3A%0A%20%20stage%3A%20.post%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E8%AF%A5%E4%BD%9C%E4%B8%9A%E5%9C%A8%20.post%20%E9%98%B6%E6%AE%B5%E8%BF%90%E8%A1%8C%EF%BC%8C%E5%9C%A8%E6%89%80%E6%9C%89%E5%85%B6%E4%BB%96%E9%98%B6%E6%AE%B5%E4%B9%8B%E5%90%8E%22%0A%0Ajob2%3A%0A%20%20stage%3A%20test%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E8%AF%A5%E4%BD%9C%E4%B8%9A%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%98%B6%E6%AE%B5%E8%BF%90%E8%A1%8C%22",
      "encoded": true
    },
    {
      "id": "s5-91",
      "sectionId": "s5",
      "title": "trigger",
      "kind": "text",
      "body": "声明一个作业是一个“触发作业”"
    },
    {
      "id": "s5-92",
      "sectionId": "s5",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "trigger-multi-project-pipeline:\n  trigger: my-group/my-project"
    },
    {
      "id": "s5-93",
      "sectionId": "s5",
      "title": "trigger:include",
      "kind": "code",
      "lang": "yml",
      "code": "trigger-child-pipeline:\n  trigger:\n    include: path/to/child-pipeline.gitlab-ci.yml"
    },
    {
      "id": "s5-94",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "声明作业是启动子管道的“触发器作业”"
    },
    {
      "id": "s5-95",
      "sectionId": "s5",
      "title": "trigger:project",
      "kind": "code",
      "lang": "yml",
      "code": "trigger-multi-project-pipeline:\n  trigger:\n    project: my-group/my-project"
    },
    {
      "id": "s5-96",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "声明作业是启动多项目管道的“触发器作业”"
    },
    {
      "id": "s5-97",
      "sectionId": "s5",
      "title": "trigger:strategy",
      "kind": "code",
      "lang": "yml",
      "code": "trigger-multi-project-pipeline:\n  trigger:\n    project: my-group/my-project\n    branch: development"
    },
    {
      "id": "s5-98",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "强制触发作业等待下游管道完成后再标记为成功"
    },
    {
      "id": "s5-99",
      "sectionId": "s5",
      "title": "trigger:forward",
      "kind": "code",
      "lang": "yml",
      "code": "variables: # 每个作业的默认变量\n  VAR: value\n\n# 默认行为：\n# - VAR 传递给孩子\n# - MYVAR 没有传递给孩子\nchild1:\n  trigger:\n    include: .child-pipeline.yml\n\n# 转发管道变量：\n# - VAR 传递给孩子\n# - MYVAR 传递给孩子\nchild2:\n  trigger:\n    include: .child-pipeline.yml\n    forward:\n      pipeline_variables: true\n\n# 不要转发 YAML 变量：\n# - VAR 不会传递给孩子\n# - MYVAR 没有传递给孩子\nchild3:\n  trigger:\n    include: .child-pipeline.yml\n    forward:\n      yaml_variables: false"
    },
    {
      "id": "s5-100",
      "sectionId": "s5",
      "title": "variables",
      "kind": "text",
      "body": "CI/CD 变量是传递给作业的可配置值。使用变量创建自定义变量"
    },
    {
      "id": "s5-101",
      "sectionId": "s5",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "variables%3A%0A%20%20DEPLOY_SITE%3A%20%22https%3A%2F%2Fexample.com%2F%22%0A%0Adeploy_job%3A%0A%20%20stage%3A%20deploy%0A%20%20script%3A%0A%20%20%20%20-%20deploy-script%20--url%20%24DEPLOY_SITE%20--path%20%22%2F%22%0A%20%20environment%3A%20production%0A%0Adeploy_review_job%3A%0A%20%20stage%3A%20deploy%0A%20%20variables%3A%0A%20%20%20%20REVIEW_PATH%3A%20%22%2Freview%22%0A%20%20script%3A%0A%20%20%20%20-%20deploy-review-script%20--url%20%24DEPLOY_SITE%20--path%20%24REVIEW_PATH%0A%20%20environment%3A%20production",
      "encoded": true
    },
    {
      "id": "s5-102",
      "sectionId": "s5",
      "title": "variables%3Adescription",
      "kind": "code",
      "lang": "yml",
      "code": "variables%3A%0A%20%20DEPLOY_ENVIRONMENT%3A%0A%20%20%20%20description%3A%20%22%E9%83%A8%E7%BD%B2%E7%9B%AE%E6%A0%87%E3%80%82%20%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%EF%BC%8C%E5%B0%86%E6%AD%A4%E5%8F%98%E9%87%8F%E6%9B%B4%E6%94%B9%E4%B8%BA%E2%80%9Ccanary%E2%80%9D%E6%88%96%E2%80%9Cproduction%E2%80%9D%22%0A%20%20%20%20value%3A%20%22staging%22",
      "encoded": true
    },
    {
      "id": "s5-103",
      "sectionId": "s5",
      "title": "variables:expand",
      "kind": "code",
      "lang": "yml",
      "code": "variables:\n  VAR1: value1\n  VAR2: value2 $VAR1\n  VAR3:\n    value: value3 $VAR1\n    expand: false"
    },
    {
      "id": "s5-104",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": "使用 `expand` 关键字将变量配置为可扩展或不可扩展"
    },
    {
      "id": "s5-105",
      "sectionId": "s5",
      "title": "when",
      "kind": "text",
      "body": "使用 `when` 配置作业运行的条件。如果未在作业中定义，则默认值为 `when:on_success`"
    },
    {
      "id": "s5-106",
      "sectionId": "s5",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "stages:\n  - build\n  - cleanup_build\n  - test\n  - deploy\n  - cleanup\n\nbuild_job:\n  stage: build\n  script:\n    - make build\n\ncleanup_build_job:\n  stage: cleanup_build\n  script:\n    - cleanup build when failed\n  when: on_failure\n\ntest_job:\n  stage: test\n  script:\n    - make test\n\ndeploy_job:\n  stage: deploy\n  script:\n    - make deploy\n  when: manual\n  environment: production\n\ncleanup_job:\n  stage: cleanup\n  script:\n    - cleanup after jobs\n  when: always"
    },
    {
      "id": "s5-107",
      "sectionId": "s5",
      "title": "",
      "kind": "text",
      "body": ":- | --\n:- | --\n`on_success(default)` | 仅当早期阶段的所有作业都成功或具有 `allow_failure: true` 时才运行该作业\n`manual` | 仅在手动触发时运行作业\n`always` | 无论早期阶段的作业状态如何，都运行作业。也可以用在 `workflow:rules` 中\n`on_failure` | 仅当早期阶段的至少一项作业失败时才运行该作业\n`delayed` | 将作业的执行延迟指定的持续时间\n`never` | 不要运行作业。只能在规则[rules](#rules)部分或工作流中使用：`workflow: rules`\n<!--rehype:className=style-list-->"
    },
    {
      "id": "s6-108",
      "sectionId": "s6",
      "title": "artifacts",
      "kind": "text",
      "body": "使用工件指定要将哪些文件另存为作业 artifacts。作业 artifacts 是作业成功、失败或始终附加到作业的文件和目录的列表"
    },
    {
      "id": "s6-109",
      "sectionId": "s6",
      "title": "artifacts:paths",
      "kind": "text",
      "body": "路径是相对于项目目录（$CI_PROJECT_DIR）的，不能直接链接到项目目录之外"
    },
    {
      "id": "s6-110",
      "sectionId": "s6",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "job:\n  artifacts:\n    paths:\n      - binaries/\n      - .config"
    },
    {
      "id": "s6-111",
      "sectionId": "s6",
      "title": "artifacts:exclude",
      "kind": "text",
      "body": "防止将文件添加到 artifacts 存档中"
    },
    {
      "id": "s6-112",
      "sectionId": "s6",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "artifacts:\n  paths:\n    - binaries/\n  exclude:\n    - binaries/**/*.o"
    },
    {
      "id": "s6-113",
      "sectionId": "s6",
      "title": "artifacts:expire_in",
      "kind": "text",
      "body": "指定作业 artifacts 在它们过期和被删除之前存储多长时间"
    },
    {
      "id": "s6-114",
      "sectionId": "s6",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "job:\n  artifacts:\n    expire_in: 1 week"
    },
    {
      "id": "s6-115",
      "sectionId": "s6",
      "title": "",
      "kind": "text",
      "body": "• '42'\n• 42 seconds\n• 3 mins 4 sec\n• 2 hrs 20 min\n• 2h20min\n• 6 mos 1 day\n• 47 yrs 6 mos and 4d\n• 3 weeks and 2 days\n• never"
    },
    {
      "id": "s6-116",
      "sectionId": "s6",
      "title": "artifacts:expose_as",
      "kind": "text",
      "body": "使用 `artifacts:expose_as` 关键字在合并请求 UI 中公开作业 artifacts"
    },
    {
      "id": "s6-117",
      "sectionId": "s6",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "test%3A%0A%20%20script%3A%20%5B%22echo%20'test'%20%3E%20file.txt%22%5D%0A%20%20artifacts%3A%0A%20%20%20%20expose_as%3A%20'artifact%201'%0A%20%20%20%20paths%3A%20%5B'file.txt'%5D",
      "encoded": true
    },
    {
      "id": "s6-118",
      "sectionId": "s6",
      "title": "artifacts:name",
      "kind": "text",
      "body": "定义创建的 `artifacts` 存档的名称。您可以为每个存档指定一个唯一的名称"
    },
    {
      "id": "s6-119",
      "sectionId": "s6",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "job%3A%0A%20%20artifacts%3A%0A%20%20%20%20name%3A%20%22job1-artifacts-file%22%0A%20%20%20%20paths%3A%0A%20%20%20%20%20%20-%20binaries%2F",
      "encoded": true
    },
    {
      "id": "s6-120",
      "sectionId": "s6",
      "title": "artifacts:public",
      "kind": "text",
      "body": "确定作业工件是否应该公开可用"
    },
    {
      "id": "s6-121",
      "sectionId": "s6",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "job:\n  artifacts:\n    public: false"
    },
    {
      "id": "s6-122",
      "sectionId": "s6",
      "title": "artifacts:reports",
      "kind": "text",
      "body": "收集作业中包含的模板生成的 `artifacts`"
    },
    {
      "id": "s6-123",
      "sectionId": "s6",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "rspec:\n  stage: test\n  script:\n    - bundle install\n    - rspec --format RspecJunitFormatter --out rspec.xml\n  artifacts:\n    reports:\n      junit: rspec.xml"
    },
    {
      "id": "s6-124",
      "sectionId": "s6",
      "title": "artifacts:untracked",
      "kind": "text",
      "body": "将所有 Git 未跟踪文件添加为 `artifacts`（连同在 `artifacts:paths` 中定义的路径）"
    },
    {
      "id": "s6-125",
      "sectionId": "s6",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "job:\n  artifacts:\n    untracked: true"
    },
    {
      "id": "s6-126",
      "sectionId": "s6",
      "title": "artifacts:when",
      "kind": "text",
      "body": "作业失败或尽管失败时上传 `artifacts`"
    },
    {
      "id": "s6-127",
      "sectionId": "s6",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "job:\n  artifacts:\n    when: on_failure"
    },
    {
      "id": "s7-128",
      "sectionId": "s7",
      "title": "cache%3Apaths",
      "kind": "code",
      "lang": "yml",
      "code": "rspec%3A%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E6%AD%A4%E4%BD%9C%E4%B8%9A%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98%22%0A%20%20cache%3A%0A%20%20%20%20key%3A%20binaries-cache%0A%20%20%20%20paths%3A%0A%20%20%20%20%20%20-%20binaries%2F*.apk%0A%20%20%20%20%20%20-%20.config",
      "encoded": true
    },
    {
      "id": "s7-129",
      "sectionId": "s7",
      "title": "",
      "kind": "text",
      "body": "关键字来选择要缓存的文件或目录"
    },
    {
      "id": "s7-130",
      "sectionId": "s7",
      "title": "cache:key",
      "kind": "text",
      "body": "为每个缓存提供唯一的标识键。 使用相同缓存键的所有作业都使用相同的缓存，包括在不同的管道中"
    },
    {
      "id": "s7-131",
      "sectionId": "s7",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "cache-job%3A%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E6%AD%A4%E4%BD%9C%E4%B8%9A%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98%22%0A%20%20cache%3A%0A%20%20%20%20key%3A%20binaries-cache-%24CI_COMMIT_REF_SLUG%0A%20%20%20%20paths%3A%0A%20%20%20%20%20%20-%20binaries%2F",
      "encoded": true
    },
    {
      "id": "s7-132",
      "sectionId": "s7",
      "title": "%60cache%3Akey%3Afiles%60",
      "kind": "code",
      "lang": "yml",
      "code": "cache-job%3A%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E6%AD%A4%E4%BD%9C%E4%B8%9A%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98%22%0A%20%20cache%3A%0A%20%20%20%20key%3A%0A%20%20%20%20%20%20files%3A%0A%20%20%20%20%20%20%20%20-%20Gemfile.lock%0A%20%20%20%20%20%20%20%20-%20package.json%0A%20%20%20%20paths%3A%0A%20%20%20%20%20%20-%20vendor%2Fruby%0A%20%20%20%20%20%20-%20node_modules",
      "encoded": true
    },
    {
      "id": "s7-133",
      "sectionId": "s7",
      "title": "",
      "kind": "text",
      "body": "当一个或两个特定文件更改时，使用 `cache:key:files` 关键字生成新密钥"
    },
    {
      "id": "s7-134",
      "sectionId": "s7",
      "title": "%60cache%3Akey%3Aprefix%60",
      "kind": "code",
      "lang": "yml",
      "code": "rspec%3A%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E6%AD%A4%20rspec%20%E4%BD%9C%E4%B8%9A%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98%22%0A%20%20cache%3A%0A%20%20%20%20key%3A%0A%20%20%20%20%20%20files%3A%0A%20%20%20%20%20%20%20%20-%20Gemfile.lock%0A%20%20%20%20%20%20prefix%3A%20%24CI_JOB_NAME%0A%20%20%20%20paths%3A%0A%20%20%20%20%20%20-%20vendor%2Fruby",
      "encoded": true
    },
    {
      "id": "s7-135",
      "sectionId": "s7",
      "title": "",
      "kind": "text",
      "body": "使用 `cache:key:prefix` 将前缀与为 `cache:key:files` 计算的 SHA 结合起来"
    },
    {
      "id": "s7-136",
      "sectionId": "s7",
      "title": "cache:untracked",
      "kind": "code",
      "lang": "yml",
      "code": "rspec:\n  script: test\n  cache:\n    untracked: true\n    paths:\n      - binaries/"
    },
    {
      "id": "s7-137",
      "sectionId": "s7",
      "title": "",
      "kind": "text",
      "body": "使用 `untracked: true` 缓存 Git 存储库中所有未跟踪的文件"
    },
    {
      "id": "s7-138",
      "sectionId": "s7",
      "title": "cache:when",
      "kind": "code",
      "lang": "yml",
      "code": "rspec:\n  script: rspec\n  cache:\n    paths:\n      - rspec/\n    when: 'always'"
    },
    {
      "id": "s7-139",
      "sectionId": "s7",
      "title": "",
      "kind": "text",
      "body": "使用 `cache:when` 根据作业的状态定义何时保存缓存"
    },
    {
      "id": "s7-140",
      "sectionId": "s7",
      "title": "",
      "kind": "text",
      "body": ":- | --\n:- | --\n`on_succes(默认)` | 仅当作业成功时才保存缓存\n`on_failure` | 仅在作业失败时才保存缓存\n`always` | 始终保存缓存"
    },
    {
      "id": "s7-141",
      "sectionId": "s7",
      "title": "cache%3Apolicy",
      "kind": "code",
      "lang": "yml",
      "code": "prepare-dependencies-job%3A%0A%20%20stage%3A%20build%0A%20%20cache%3A%0A%20%20%20%20key%3A%20gems%0A%20%20%20%20paths%3A%0A%20%20%20%20%20%20-%20vendor%2Fbundle%0A%20%20%20%20policy%3A%20push%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E6%AD%A4%E4%BD%9C%E4%B8%9A%E4%BB%85%E4%B8%8B%E8%BD%BD%E4%BE%9D%E8%B5%96%E9%A1%B9%E5%B9%B6%E6%9E%84%E5%BB%BA%E7%BC%93%E5%AD%98%22%0A%20%20%20%20-%20echo%20%22%E6%AD%A3%E5%9C%A8%E4%B8%8B%E8%BD%BD%E4%BE%9D%E8%B5%96...%22%0A%0Afaster-test-job%3A%0A%20%20stage%3A%20test%0A%20%20cache%3A%0A%20%20%20%20key%3A%20gems%0A%20%20%20%20paths%3A%0A%20%20%20%20%20%20-%20vendor%2Fbundle%0A%20%20%20%20policy%3A%20pull%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E6%AD%A4%E4%BD%9C%E4%B8%9A%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98%EF%BC%8C%E4%BD%86%E4%B8%8D%E6%9B%B4%E6%96%B0%E5%AE%83%22%0A%20%20%20%20-%20echo%20%22%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95...%22",
      "encoded": true
    },
    {
      "id": "s7-142",
      "sectionId": "s7",
      "title": "",
      "kind": "text",
      "body": "要更改缓存的上传和下载行为，请使用 `cache:policy` 关键字"
    },
    {
      "id": "s8-143",
      "sectionId": "s8",
      "title": "environment:name",
      "kind": "code",
      "lang": "yml",
      "code": "deploy to production:\n  stage: deploy\n  script: git push production HEAD:main\n  environment:\n    name: production"
    },
    {
      "id": "s8-144",
      "sectionId": "s8",
      "title": "",
      "kind": "text",
      "body": "为环境设置名称"
    },
    {
      "id": "s8-145",
      "sectionId": "s8",
      "title": "environment:url",
      "kind": "code",
      "lang": "yml",
      "code": "deploy to production:\n  stage: deploy\n  script: git push production HEAD:main\n  environment:\n    name: production\n    url: https://prod.example.com"
    },
    {
      "id": "s8-146",
      "sectionId": "s8",
      "title": "",
      "kind": "text",
      "body": "为环境设置 URL"
    },
    {
      "id": "s8-147",
      "sectionId": "s8",
      "title": "environment:on_stop",
      "kind": "text",
      "body": "关闭（停止）环境可以通过在环境下定义的 on_stop 关键字来实现。 它声明运行以关闭环境的不同作业"
    },
    {
      "id": "s8-148",
      "sectionId": "s8",
      "title": "environment:action",
      "kind": "code",
      "lang": "yml",
      "code": "stop_review_app:\n  stage: deploy\n  variables:\n    GIT_STRATEGY: none\n  script: make delete-app\n  when: manual\n  environment:\n    name: review/$CI_COMMIT_REF_SLUG\n    action: stop"
    },
    {
      "id": "s8-149",
      "sectionId": "s8",
      "title": "",
      "kind": "text",
      "body": ":- | --\n:- | --\n`start` _默认值_ | 指示作业启动环境。在作业开始后创建的\n`prepare` | 表示作业只是准备环境。它不会触发部署\n`stop` | 指示作业停止部署\n`verify` | 指示作业仅验证环境。它不会触发部署\n`access` | 指示作业仅访问环境。它不会触发部署"
    },
    {
      "id": "s8-150",
      "sectionId": "s8",
      "title": "environment:auto_stop_in",
      "kind": "code",
      "lang": "yml",
      "code": "review_app:\n  script: deploy-review-app\n  environment:\n    name: review/$CI_COMMIT_REF_SLUG\n    auto_stop_in: 1 day"
    },
    {
      "id": "s8-151",
      "sectionId": "s8",
      "title": "",
      "kind": "text",
      "body": "• `168 hours`\n• `7 days`\n• `one week`\n• `never`"
    },
    {
      "id": "s8-152",
      "sectionId": "s8",
      "title": "",
      "kind": "text",
      "body": "`auto_stop_in` 关键字指定环境的生命周期。 当环境到期时，GitLab 会自动停止它"
    },
    {
      "id": "s8-153",
      "sectionId": "s8",
      "title": "environment:kubernetes",
      "kind": "code",
      "lang": "yml",
      "code": "deploy:\n  stage: deploy\n  script: make deploy-app\n  environment:\n    name: production\n    kubernetes:\n      namespace: production"
    },
    {
      "id": "s8-154",
      "sectionId": "s8",
      "title": "",
      "kind": "text",
      "body": "使用 `kubernetes` 关键字将部署配置到与您的项目关联的 `Kubernetes` 集群"
    },
    {
      "id": "s8-155",
      "sectionId": "s8",
      "title": "environment:deployment_tier",
      "kind": "code",
      "lang": "yml",
      "code": "deploy:\n  script: echo\n  environment:\n    name: customer-portal\n    deployment_tier: production"
    },
    {
      "id": "s8-156",
      "sectionId": "s8",
      "title": "",
      "kind": "text",
      "body": "• `production`\n• `staging`\n• `testing`\n• `development`\n• `other`"
    },
    {
      "id": "s8-157",
      "sectionId": "s8",
      "title": "动态 environment",
      "kind": "code",
      "lang": "yml",
      "code": "deploy as review app:\n  stage: deploy\n  script: make deploy\n  environment:\n    name: review/$CI_COMMIT_REF_SLUG\n    url: https://$CI_ENVIRONMENT_SLUG.example.com/"
    },
    {
      "id": "s9-158",
      "sectionId": "s9",
      "title": "image%3Aname",
      "kind": "code",
      "lang": "yml",
      "code": "image%3A%0A%20%20name%3A%20%22registry.example.com%2Fmy%2Fimage%3Alatest%22",
      "encoded": true
    },
    {
      "id": "s9-159",
      "sectionId": "s9",
      "title": "",
      "kind": "text",
      "body": "作业运行所在的 Docker 镜像的名称。类似于它自己使用的镜像"
    },
    {
      "id": "s9-160",
      "sectionId": "s9",
      "title": "image%3Aentrypoint",
      "kind": "code",
      "lang": "yml",
      "code": "image%3A%0A%20%20name%3A%20super%2Fsql%3Aexperimental%0A%20%20entrypoint%3A%20%5B%22%22%5D",
      "encoded": true
    },
    {
      "id": "s9-161",
      "sectionId": "s9",
      "title": "",
      "kind": "text",
      "body": "作为容器入口点执行的命令或脚本"
    },
    {
      "id": "s9-162",
      "sectionId": "s9",
      "title": "image%3Apull_policy",
      "kind": "code",
      "lang": "yml",
      "code": "job1%3A%0A%20%20script%3A%20echo%20%22%E5%8D%95%E4%B8%80%E6%8B%89%E5%8A%A8%E6%94%BF%E7%AD%96%22%0A%20%20image%3A%0A%20%20%20%20name%3A%20ruby%3A3.0%0A%20%20%20%20pull_policy%3A%20if-not-present%0A%0Ajob2%3A%0A%20%20script%3A%20echo%20%22%E5%A4%9A%E9%87%8D%E6%8B%89%E5%8A%A8%E6%94%BF%E7%AD%96%22%0A%20%20image%3A%0A%20%20%20%20name%3A%20ruby%3A3.0%0A%20%20%20%20pull_policy%3A%20%5Balways%2C%20if-not-present%5D",
      "encoded": true
    },
    {
      "id": "s9-163",
      "sectionId": "s9",
      "title": "",
      "kind": "text",
      "body": "运行器用于获取 Docker 映像的拉取策略"
    },
    {
      "id": "s10-164",
      "sectionId": "s10",
      "title": "needs:artifacts",
      "kind": "text",
      "body": "当作业使用需求时，它不再默认下载先前阶段的所有工件，因为有需求的作业可以在早期阶段完成之前开始"
    },
    {
      "id": "s10-165",
      "sectionId": "s10",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "test-job1:\n  stage: test\n  needs:\n    - job: build_job1\n      artifacts: true\n\ntest-job2:\n  stage: test\n  needs:\n    - job: build_job2\n      artifacts: false\n\ntest-job3:\n  needs:\n    - job: build_job1\n      artifacts: true\n    - job: build_job2\n    - build_job3"
    },
    {
      "id": "s10-166",
      "sectionId": "s10",
      "title": "needs:project",
      "kind": "text",
      "body": "使用 `needs:project` 从其他管道中的最多五个作业下载工件。工件是从指定参考的最新成功管道下载的。要指定多个作业，请将每个作业作为单独的数组项添加到 needs 关键字下"
    },
    {
      "id": "s10-167",
      "sectionId": "s10",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "build_job:\n  stage: build\n  script:\n    - ls -lhR\n  needs:\n    - project: namespace/group/project-name\n      job: build-1\n      ref: main\n      artifacts: true\n    - project: namespace/group/project-name-2\n      job: build-2\n      ref: main\n      artifacts: true"
    },
    {
      "id": "s10-168",
      "sectionId": "s10",
      "title": "needs%3Apipeline%3Ajob",
      "kind": "code",
      "lang": "yml",
      "code": "create-artifact%3A%0A%20%20stage%3A%20build%0A%20%20script%3A%20echo%20%22sample%20artifact%22%20%3E%20artifact.txt%0A%20%20artifacts%3A%0A%20%20%20%20paths%3A%20%5Bartifact.txt%5D%0A%0Achild-pipeline%3A%0A%20%20stage%3A%20test%0A%20%20trigger%3A%0A%20%20%20%20include%3A%20child.yml%0A%20%20%20%20strategy%3A%20depend%0A%20%20variables%3A%0A%20%20%20%20PARENT_PIPELINE_ID%3A%20%24CI_PIPELINE_ID",
      "encoded": true
    },
    {
      "id": "s10-169",
      "sectionId": "s10",
      "title": "",
      "kind": "text",
      "body": "子管道可以从其父管道中的作业或同一父子管道层次结构中的另一个子管道下载工件"
    },
    {
      "id": "s10-170",
      "sectionId": "s10",
      "title": "needs:optional",
      "kind": "text",
      "body": "要需要管道中有时不存在的作业，请将 `optional: true` 添加到需求配置中。如果未定义，则可选：默认为 `false`"
    },
    {
      "id": "s10-171",
      "sectionId": "s10",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "build-job:\n  stage: build\n\ntest-job1:\n  stage: test\n\ntest-job2:\n  stage: test\n  rules:\n    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH\n\ndeploy-job:\n  stage: deploy\n  needs:\n    - job: test-job2\n      optional: true\n    - job: test-job1\n  environment: production\n\nreview-job:\n  stage: deploy\n  needs:\n    - job: test-job2\n      optional: true\n  environment: review"
    },
    {
      "id": "s10-172",
      "sectionId": "s10",
      "title": "needs:pipeline",
      "kind": "text",
      "body": "您可以使用 `needs:pipeline` 关键字将管道状态从上游管道镜像到桥接作业"
    },
    {
      "id": "s10-173",
      "sectionId": "s10",
      "title": "",
      "kind": "code",
      "lang": "yml",
      "code": "upstream_bridge:\n  stage: test\n  needs:\n    pipeline: other/project"
    },
    {
      "id": "s11-174",
      "sectionId": "s11",
      "title": "only:refs / except:refs",
      "kind": "code",
      "lang": "yml",
      "code": "job1:\n  script: echo\n  only:\n    - main\n    - /^issue-.*$/\n    - merge_requests\n\njob2:\n  script: echo\n  except:\n    - main\n    - /^stable-branch.*$/\n    - schedules"
    },
    {
      "id": "s11-175",
      "sectionId": "s11",
      "title": "",
      "kind": "text",
      "body": "使用 `only:refs` 和 `except:refs` 关键字来控制何时根据分支名称或管道类型将作业添加到管道"
    },
    {
      "id": "s11-176",
      "sectionId": "s11",
      "title": "only%3Avariables%20%2F%20except%3Avariables",
      "kind": "code",
      "lang": "yml",
      "code": "deploy%3A%0A%20%20script%3A%20cap%20staging%20deploy%0A%20%20only%3A%0A%20%20%20%20variables%3A%0A%20%20%20%20%20%20-%20%24RELEASE%20%3D%3D%20%22staging%22%0A%20%20%20%20%20%20-%20%24STAGING",
      "encoded": true
    },
    {
      "id": "s11-177",
      "sectionId": "s11",
      "title": "",
      "kind": "text",
      "body": "根据 CI/CD 变量的状态，使用 only:variables 或 except:variables 关键字来控制何时将作业添加到管道"
    },
    {
      "id": "s11-178",
      "sectionId": "s11",
      "title": "only%3Achanges%20%2F%20except%3Achanges",
      "kind": "code",
      "lang": "yml",
      "code": "docker%20build%3A%0A%20%20script%3A%20docker%20build%20-t%20my-image%3A%24CI_COMMIT_REF_SLUG%20.%0A%20%20only%3A%0A%20%20%20%20refs%3A%0A%20%20%20%20%20%20-%20branches%0A%20%20%20%20changes%3A%0A%20%20%20%20%20%20-%20Dockerfile%0A%20%20%20%20%20%20-%20docker%2Fscripts%2F*%0A%20%20%20%20%20%20-%20dockerfiles%2F**%2F*%0A%20%20%20%20%20%20-%20more_scripts%2F*.%7Brb%2Cpy%2Csh%7D%0A%20%20%20%20%20%20-%20%22**%2F*.json%22",
      "encoded": true
    },
    {
      "id": "s11-179",
      "sectionId": "s11",
      "title": "",
      "kind": "text",
      "body": "当 `Git` 推送事件修改文件时，使用 `changes` 关键字仅运行作业，或使用 `except` 跳过作业"
    },
    {
      "id": "s11-180",
      "sectionId": "s11",
      "title": "only:kubernetes / except:kubernetes",
      "kind": "code",
      "lang": "yml",
      "code": "deploy:\n  only:\n    kubernetes: active"
    },
    {
      "id": "s11-181",
      "sectionId": "s11",
      "title": "",
      "kind": "text",
      "body": "使用 `only:kubernetes` 或 `except:kubernetes` 来控制当 `Kubernetes` 服务在项目中处于活动状态时是否将作业添加到管道中"
    },
    {
      "id": "s12-182",
      "sectionId": "s12",
      "title": "release 参考",
      "kind": "text",
      "body": ":- | --\n:- | --\n[release:tag_name](#releasetag_name) | 发布的 Git 标签\n[release:tag_message](#releasetag_message) | 指定的消息进行注释\n[release:name](#releasename) | 发布名称\n[release:description](#releasedescription) | 版本的详细描述\n[release:ref](#releaseref) | 发布的 ref\n[release:milestones](#releasemilestones) | 每个里程碑的标题\n[release:released_at](#releasereleased_at) | 发布准备就绪的日期和时间"
    },
    {
      "id": "s12-183",
      "sectionId": "s12",
      "title": "release%3Atag_name",
      "kind": "code",
      "lang": "yml",
      "code": "job%3A%0A%20%20script%3A%20echo%20%22%E4%B8%BA%E6%96%B0%E6%A0%87%E7%AD%BE%E8%BF%90%E8%A1%8C%E5%8F%91%E5%B8%83%E4%BD%9C%E4%B8%9A%22%0A%20%20release%3A%0A%20%20%20%20tag_name%3A%20%24CI_COMMIT_TAG%0A%20%20%20%20description%3A%20'Release%20description'%0A%20%20rules%3A%0A%20%20%20%20-%20if%3A%20%24CI_COMMIT_TAG",
      "encoded": true
    },
    {
      "id": "s12-184",
      "sectionId": "s12",
      "title": "",
      "kind": "text",
      "body": "必需的。发布的 Git 标签"
    },
    {
      "id": "s12-185",
      "sectionId": "s12",
      "title": "release:tag_message",
      "kind": "code",
      "lang": "yml",
      "code": "release_job:\n  stage: release\n  release:\n    tag_name: $CI_COMMIT_TAG\n    description: 'Release description'\n    tag_message: 'Annotated tag message'"
    },
    {
      "id": "s12-186",
      "sectionId": "s12",
      "title": "",
      "kind": "text",
      "body": "如果标签不存在，则新创建的标签将使用 `tag_message` 指定的消息进行注释"
    },
    {
      "id": "s12-187",
      "sectionId": "s12",
      "title": "release:name",
      "kind": "code",
      "lang": "yml",
      "code": "release_job:\n  stage: release\n  release:\n    name: 'Release $CI_COMMIT_TAG'"
    },
    {
      "id": "s12-188",
      "sectionId": "s12",
      "title": "",
      "kind": "text",
      "body": "发布名称。如果省略，它会填充 `release:tag_name` 的值"
    },
    {
      "id": "s12-189",
      "sectionId": "s12",
      "title": "release:description",
      "kind": "code",
      "lang": "yml",
      "code": "job:\n  release:\n    tag_name: ${MAJOR}_${MINOR}_${REVISION}\n    description: './path/to/CHANGELOG.md'"
    },
    {
      "id": "s12-190",
      "sectionId": "s12",
      "title": "",
      "kind": "text",
      "body": "版本的详细描述"
    },
    {
      "id": "s12-191",
      "sectionId": "s12",
      "title": "release:ref",
      "kind": "text",
      "body": "发布的 ref，如果发布：`tag_name` 尚不存在"
    },
    {
      "id": "s12-192",
      "sectionId": "s12",
      "title": "release:milestones",
      "kind": "text",
      "body": "与版本关联的每个里程碑的标题"
    },
    {
      "id": "s12-193",
      "sectionId": "s12",
      "title": "release:released_at",
      "kind": "code",
      "lang": "yml",
      "code": "released_at: '2021-03-15T08:00:00Z'"
    },
    {
      "id": "s12-194",
      "sectionId": "s12",
      "title": "",
      "kind": "text",
      "body": "发布准备就绪的日期和时间"
    },
    {
      "id": "s12-195",
      "sectionId": "s12",
      "title": "release:assets:links",
      "kind": "code",
      "lang": "yml",
      "code": "assets:\n  links:\n    - name: 'asset1'\n      url: 'https://example.com/assets/1'\n    - name: 'asset2'\n      url: 'https://example.com/assets/2'\n      filepath: '/pretty/url/1' # 可选的\n      link_type: 'other' # 可选的"
    },
    {
      "id": "s12-196",
      "sectionId": "s12",
      "title": "",
      "kind": "text",
      "body": "使用 `release:assets:links` 在发布中包含资产链接"
    },
    {
      "id": "s13-197",
      "sectionId": "s13",
      "title": "rules%3Aif",
      "kind": "code",
      "lang": "yml",
      "code": "job%3A%0A%20%20script%3A%20echo%20%22Hello%2C%20Rules!%22%0A%20%20rules%3A%0A%20%20%20%20-%20if%3A%20%24CI_MERGE_REQUEST_SOURCE_BRANCH_NAME%20%3D~%20%2F%5Efeature%2F%20%26%26%20%24CI_MERGE_REQUEST_TARGET_BRANCH_NAME%20!%3D%20%24CI_DEFAULT_BRANCH%0A%20%20%20%20%20%20when%3A%20never%0A%20%20%20%20-%20if%3A%20%24CI_MERGE_REQUEST_SOURCE_BRANCH_NAME%20%3D~%20%2F%5Efeature%2F%0A%20%20%20%20%20%20when%3A%20manual%0A%20%20%20%20%20%20allow_failure%3A%20true%0A%20%20%20%20-%20if%3A%20%24CI_MERGE_REQUEST_SOURCE_BRANCH_NAME",
      "encoded": true
    },
    {
      "id": "s13-198",
      "sectionId": "s13",
      "title": "",
      "kind": "text",
      "body": "使用 `rules:if` 子句指定何时将作业添加到管道"
    },
    {
      "id": "s13-199",
      "sectionId": "s13",
      "title": "rules%3Achanges",
      "kind": "code",
      "lang": "yml",
      "code": "docker%20build%3A%0A%20%20script%3A%20docker%20build%20-t%20my-image%3A%24CI_COMMIT_REF_SLUG%20.%0A%20%20rules%3A%0A%20%20%20%20-%20if%3A%20%24CI_PIPELINE_SOURCE%20%3D%3D%20%22merge_request_event%22%0A%20%20%20%20%20%20changes%3A%0A%20%20%20%20%20%20%20%20-%20Dockerfile%0A%20%20%20%20%20%20when%3A%20manual%0A%20%20%20%20%20%20allow_failure%3A%20true",
      "encoded": true
    },
    {
      "id": "s13-200",
      "sectionId": "s13",
      "title": "",
      "kind": "text",
      "body": "使用 `rules:changes` 通过检查对特定文件的更改来指定何时将作业添加到管道"
    },
    {
      "id": "s13-201",
      "sectionId": "s13",
      "title": "rules%3Achanges%3Apaths",
      "kind": "code",
      "lang": "yml",
      "code": "docker-build-1%3A%0A%20%20script%3A%20docker%20build%20-t%20my-image%3A%24CI_COMMIT_REF_SLUG%20.%0A%20%20rules%3A%0A%20%20%20%20-%20if%3A%20%24CI_PIPELINE_SOURCE%20%3D%3D%20%22merge_request_event%22%0A%20%20%20%20%20%20changes%3A%0A%20%20%20%20%20%20%20%20-%20Dockerfile%0A%0Adocker-build-2%3A%0A%20%20script%3A%20docker%20build%20-t%20my-image%3A%24CI_COMMIT_REF_SLUG%20.%0A%20%20rules%3A%0A%20%20%20%20-%20if%3A%20%24CI_PIPELINE_SOURCE%20%3D%3D%20%22merge_request_event%22%0A%20%20%20%20%20%20changes%3A%0A%20%20%20%20%20%20%20%20paths%3A%0A%20%20%20%20%20%20%20%20%20%20-%20Dockerfile",
      "encoded": true
    },
    {
      "id": "s13-202",
      "sectionId": "s13",
      "title": "",
      "kind": "text",
      "body": "使用 `rules:changes` 指定仅在更改特定文件时将作业添加到管道，并使用 `rules:changes:paths` 指定文件"
    },
    {
      "id": "s13-203",
      "sectionId": "s13",
      "title": "rules%3Achanges%3Acompare_to",
      "kind": "code",
      "lang": "yml",
      "code": "docker%20build%3A%0A%20%20script%3A%20docker%20build%20-t%20my-image%3A%24CI_COMMIT_REF_SLUG%20.%0A%20%20rules%3A%0A%20%20%20%20-%20if%3A%20%24CI_PIPELINE_SOURCE%20%3D%3D%20%22merge_request_event%22%0A%20%20%20%20%20%20changes%3A%0A%20%20%20%20%20%20%20%20paths%3A%0A%20%20%20%20%20%20%20%20%20%20-%20Dockerfile%0A%20%20%20%20%20%20%20%20compare_to%3A%20'refs%2Fheads%2Fbranch1'",
      "encoded": true
    },
    {
      "id": "s13-204",
      "sectionId": "s13",
      "title": "",
      "kind": "text",
      "body": "使用 `rules:changes:compare_to` 指定要比较哪个 `ref` 来比较 `rules:changes:paths` 下列出的文件的更改"
    },
    {
      "id": "s13-205",
      "sectionId": "s13",
      "title": "rules:exists",
      "kind": "code",
      "lang": "yml",
      "code": "job:\n  script: docker build -t my-image:$CI_COMMIT_REF_SLUG .\n  rules:\n    - exists:\n        - Dockerfile"
    },
    {
      "id": "s13-206",
      "sectionId": "s13",
      "title": "",
      "kind": "text",
      "body": "当存储库中存在某些文件时，使用 `exists` 运行作业"
    },
    {
      "id": "s13-207",
      "sectionId": "s13",
      "title": "rules%3Aallow_failure",
      "kind": "code",
      "lang": "yml",
      "code": "job%3A%0A%20%20script%3A%20echo%20%22Hello%2C%20Rules!%22%0A%20%20rules%3A%0A%20%20%20%20-%20if%3A%20%24CI_MERGE_REQUEST_TARGET_BRANCH_NAME%20%3D%3D%20%24CI_DEFAULT_BRANCH%0A%20%20%20%20%20%20when%3A%20manual%0A%20%20%20%20%20%20allow_failure%3A%20true",
      "encoded": true
    },
    {
      "id": "s13-208",
      "sectionId": "s13",
      "title": "",
      "kind": "text",
      "body": "在规则中使用 `allow_failure: true` 允许作业失败而不停止管道"
    },
    {
      "id": "s13-209",
      "sectionId": "s13",
      "title": "rules%3Avariables",
      "kind": "code",
      "lang": "yml",
      "code": "job%3A%0A%20%20variables%3A%0A%20%20%20%20DEPLOY_VARIABLE%3A%20%22default-deploy%22%0A%20%20rules%3A%0A%20%20%20%20-%20if%3A%20%24CI_COMMIT_REF_NAME%20%3D%3D%20%24CI_DEFAULT_BRANCH%0A%20%20%20%20%20%20variables%3A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E8%A6%86%E7%9B%96%E5%AE%9A%E4%B9%89%E7%9A%84%20DEPLOY_VARIABLE%0A%20%20%20%20%20%20%20%20DEPLOY_VARIABLE%3A%20%22deploy-production%22%20%20%23%20%E5%9C%A8%E5%B7%A5%E4%BD%9C%E5%B1%82%E9%9D%A2%0A%20%20%20%20-%20if%3A%20%24CI_COMMIT_REF_NAME%20%3D~%20%2Ffeature%2F%0A%20%20%20%20%20%20variables%3A%0A%20%20%20%20%20%20%20%20IS_A_FEATURE%3A%20%22true%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E6%96%B0%E5%8F%98%E9%87%8F%0A%20%20script%3A%0A%20%20%20%20-%20echo%20%22%E4%BB%A5%20%24DEPLOY_VARIABLE%20%E4%BD%9C%E4%B8%BA%E5%8F%82%E6%95%B0%E8%BF%90%E8%A1%8C%E8%84%9A%E6%9C%AC%22%0A%20%20%20%20-%20echo%20%22%E5%A6%82%E6%9E%9C%20%24IS_A_FEATURE%20%E5%AD%98%E5%9C%A8%E5%88%99%E8%BF%90%E8%A1%8C%E5%8F%A6%E4%B8%80%E4%B8%AA%E8%84%9A%E6%9C%AC%22",
      "encoded": true
    },
    {
      "id": "s13-210",
      "sectionId": "s13",
      "title": "",
      "kind": "text",
      "body": "在规则中使用变量来为特定条件定义变量"
    },
    {
      "id": "s14-211",
      "sectionId": "s14",
      "title": "另见",
      "kind": "text",
      "body": "• [.gitlab-ci.yml 关键字参考](https://docs.gitlab.com/ee/ci/yaml/)"
    }
  ],
  "source": {
    "repo": "https://github.com/jaywcjlove/reference",
    "path": "docs/gitlab-ci.md",
    "ref": "main",
    "url": "https://github.com/jaywcjlove/reference/tree/main/docs/gitlab-ci.md",
    "lang": "zh",
    "mode": "local"
  }
}